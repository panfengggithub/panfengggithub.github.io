(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{494:function(a,s,t){"use strict";t.r(s);var n=t(1),r=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"jvm-å¸¸è€ƒé¢è¯•é¢˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm-å¸¸è€ƒé¢è¯•é¢˜"}},[a._v("#")]),a._v(" JVM å¸¸è€ƒé¢è¯•é¢˜")]),a._v(" "),s("h2",{attrs:{id:"_1-ä»€ä¹ˆæ˜¯jvmå†…å­˜ç»“æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä»€ä¹ˆæ˜¯jvmå†…å­˜ç»“æ„"}},[a._v("#")]),a._v(" 1. ä»€ä¹ˆæ˜¯JVMå†…å­˜ç»“æ„ï¼Ÿ")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210220111553294.png",alt:""}})]),a._v(" "),s("p",[a._v("jvmå°†è™šæ‹Ÿæœºåˆ†ä¸º5å¤§åŒºåŸŸï¼Œç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€javaå †ã€æ–¹æ³•åŒºï¼›")]),a._v(" "),s("ul",[s("li",[a._v("ç¨‹åºè®¡æ•°å™¨ï¼šçº¿ç¨‹ç§æœ‰çš„ï¼Œæ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´ï¼Œä½œä¸ºå½“å‰çº¿ç¨‹çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œç”¨äºè®°å½•å½“å‰è™šæ‹Ÿæœºæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æŒ‡ä»¤åœ°å€ï¼›")]),a._v(" "),s("li",[a._v("è™šæ‹Ÿæœºæ ˆï¼šçº¿ç¨‹ç§æœ‰çš„ï¼Œæ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°ã€åŠ¨æ€é“¾æ¥å’Œæ–¹æ³•è¿”å›ç­‰ä¿¡æ¯ï¼Œå½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦è¶…è¿‡äº†è™šæ‹Ÿæœºå…è®¸çš„æœ€å¤§æ·±åº¦æ—¶ï¼Œå°±ä¼šæŠ›å‡ºStackOverFlowErrorï¼›")]),a._v(" "),s("li",[a._v("æœ¬åœ°æ–¹æ³•æ ˆï¼šçº¿ç¨‹ç§æœ‰çš„ï¼Œä¿å­˜çš„æ˜¯nativeæ–¹æ³•çš„ä¿¡æ¯ï¼Œå½“ä¸€ä¸ªjvmåˆ›å»ºçš„çº¿ç¨‹è°ƒç”¨nativeæ–¹æ³•åï¼Œjvmä¸ä¼šåœ¨è™šæ‹Ÿæœºæ ˆä¸­ä¸ºè¯¥çº¿ç¨‹åˆ›å»ºæ ˆå¸§ï¼Œè€Œæ˜¯ç®€å•çš„åŠ¨æ€é“¾æ¥å¹¶ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ï¼›")]),a._v(" "),s("li",[a._v("å †ï¼šjavaå †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜ï¼Œå‡ ä¹æ‰€æœ‰å¯¹è±¡çš„å®ä¾‹å’Œæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œå› æ­¤è¯¥åŒºåŸŸç»å¸¸å‘ç”Ÿåƒåœ¾å›æ”¶çš„æ“ä½œï¼›")]),a._v(" "),s("li",[a._v("æ–¹æ³•åŒºï¼šå­˜æ”¾å·²è¢«åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç æ•°æ®ã€‚å³æ°¸ä¹…ä»£ï¼Œåœ¨jdk1.8ä¸­ä¸å­˜åœ¨æ–¹æ³•åŒºäº†ï¼Œè¢«å…ƒæ•°æ®åŒºæ›¿ä»£äº†ï¼ŒåŸæ–¹æ³•åŒºè¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼›1ï¼šåŠ è½½çš„ç±»ä¿¡æ¯ï¼Œ2ï¼šè¿è¡Œæ—¶å¸¸é‡æ± ï¼›åŠ è½½çš„ç±»ä¿¡æ¯è¢«ä¿å­˜åœ¨å…ƒæ•°æ®åŒºä¸­ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± ä¿å­˜åœ¨å †ä¸­ï¼›")])]),a._v(" "),s("h2",{attrs:{id:"_2-ä»€ä¹ˆæ˜¯jvmå†…å­˜æ¨¡å‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ä»€ä¹ˆæ˜¯jvmå†…å­˜æ¨¡å‹"}},[a._v("#")]),a._v(" 2. ä»€ä¹ˆæ˜¯JVMå†…å­˜æ¨¡å‹ï¼Ÿ")]),a._v(" "),s("p",[s("strong",[a._v("Java å†…å­˜æ¨¡å‹")]),a._v("ï¼ˆä¸‹æ–‡ç®€ç§° "),s("strong",[a._v("JMM")]),a._v("ï¼‰å°±æ˜¯åœ¨åº•å±‚å¤„ç†å™¨å†…å­˜æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œå®šä¹‰è‡ªå·±çš„å¤šçº¿ç¨‹è¯­ä¹‰ã€‚å®ƒæ˜ç¡®æŒ‡å®šäº†ä¸€ç»„æ’åºè§„åˆ™ï¼Œæ¥ä¿è¯çº¿ç¨‹é—´çš„å¯è§æ€§ã€‚")]),a._v(" "),s("p",[a._v("è¿™ä¸€ç»„è§„åˆ™è¢«ç§°ä¸º "),s("strong",[a._v("Happens-Before")]),a._v(", JMM è§„å®šï¼Œè¦æƒ³ä¿è¯ B æ“ä½œèƒ½å¤Ÿçœ‹åˆ° A æ“ä½œçš„ç»“æœï¼ˆæ— è®ºå®ƒä»¬æ˜¯å¦åœ¨åŒä¸€ä¸ªçº¿ç¨‹ï¼‰ï¼Œé‚£ä¹ˆ A å’Œ B ä¹‹é—´å¿…é¡»æ»¡è¶³ "),s("strong",[a._v("Happens-Before å…³ç³»")]),a._v("ï¼š")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("å•çº¿ç¨‹è§„åˆ™")]),a._v("ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªåŠ¨ä½œéƒ½ happens-before è¯¥çº¿ç¨‹ä¸­åç»­çš„æ¯ä¸ªåŠ¨ä½œ")]),a._v(" "),s("li",[s("strong",[a._v("ç›‘è§†å™¨é”å®šè§„åˆ™")]),a._v("ï¼šç›‘å¬å™¨çš„"),s("strong",[a._v("è§£é”")]),a._v("åŠ¨ä½œ happens-before åç»­å¯¹è¿™ä¸ªç›‘å¬å™¨çš„"),s("strong",[a._v("é”å®š")]),a._v("åŠ¨ä½œ")]),a._v(" "),s("li",[s("strong",[a._v("volatile å˜é‡è§„åˆ™")]),a._v("ï¼šå¯¹ volatile å­—æ®µçš„å†™å…¥åŠ¨ä½œ happens-before åç»­å¯¹è¿™ä¸ªå­—æ®µçš„æ¯ä¸ªè¯»å–åŠ¨ä½œ")]),a._v(" "),s("li",[s("strong",[a._v("çº¿ç¨‹ start è§„åˆ™")]),a._v("ï¼šçº¿ç¨‹ "),s("strong",[a._v("start()")]),a._v(" æ–¹æ³•çš„æ‰§è¡Œ happens-before ä¸€ä¸ªå¯åŠ¨çº¿ç¨‹å†…çš„ä»»æ„åŠ¨ä½œ")]),a._v(" "),s("li",[s("strong",[a._v("çº¿ç¨‹ join è§„åˆ™")]),a._v("ï¼šä¸€ä¸ªçº¿ç¨‹å†…çš„æ‰€æœ‰åŠ¨ä½œ happens-before ä»»æ„å…¶ä»–çº¿ç¨‹åœ¨è¯¥çº¿ç¨‹ "),s("strong",[a._v("join()")]),a._v(" æˆåŠŸè¿”å›ä¹‹å‰")]),a._v(" "),s("li",[s("strong",[a._v("ä¼ é€’æ€§")]),a._v("ï¼šå¦‚æœ A happens-before B, ä¸” B happens-before C, é‚£ä¹ˆ A happens-before C")])]),a._v(" "),s("p",[a._v("æ€ä¹ˆç†è§£ happens-before å‘¢ï¼Ÿå¦‚æœæŒ‰å­—é¢æ„æ€ï¼Œæ¯”å¦‚ç¬¬äºŒä¸ªè§„åˆ™ï¼Œçº¿ç¨‹ï¼ˆä¸ç®¡æ˜¯ä¸æ˜¯åŒä¸€ä¸ªï¼‰çš„è§£é”åŠ¨ä½œå‘ç”Ÿåœ¨é”å®šä¹‹å‰ï¼Ÿè¿™æ˜æ˜¾ä¸å¯¹ã€‚happens-before ä¹Ÿæ˜¯ä¸ºäº†ä¿è¯å¯è§æ€§ï¼Œæ¯”å¦‚é‚£ä¸ªè§£é”å’ŒåŠ é”çš„åŠ¨ä½œï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼Œçº¿ç¨‹1é‡Šæ”¾é”é€€å‡ºåŒæ­¥å—ï¼Œçº¿ç¨‹2åŠ é”è¿›å…¥åŒæ­¥å—ï¼Œé‚£ä¹ˆçº¿ç¨‹2å°±èƒ½çœ‹è§çº¿ç¨‹1å¯¹å…±äº«å¯¹è±¡ä¿®æ”¹çš„ç»“æœã€‚")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210329222941923.png",alt:""}})]),a._v(" "),s("p",[a._v("Java æä¾›äº†å‡ ç§è¯­è¨€ç»“æ„ï¼ŒåŒ…æ‹¬ "),s("em",[a._v("volatile")]),a._v(", "),s("em",[a._v("final")]),a._v(" å’Œ "),s("em",[a._v("synchronized")]),a._v(", å®ƒä»¬æ—¨åœ¨å¸®åŠ©ç¨‹åºå‘˜å‘"),s("strong",[a._v("ç¼–è¯‘å™¨")]),a._v("æè¿°ç¨‹åºçš„å¹¶å‘è¦æ±‚ï¼Œå…¶ä¸­ï¼š")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("volatile")]),a._v(" - ä¿è¯"),s("strong",[a._v("å¯è§æ€§")]),a._v("å’Œ"),s("strong",[a._v("æœ‰åºæ€§")])]),a._v(" "),s("li",[s("strong",[a._v("synchronized")]),a._v(" - ä¿è¯"),s("strong",[a._v("å¯è§æ€§")]),a._v("å’Œ"),s("strong",[a._v("æœ‰åºæ€§")]),a._v("; é€šè¿‡**ç®¡ç¨‹ï¼ˆMonitorï¼‰*"),s("em",[a._v("ä¿è¯ä¸€ç»„åŠ¨ä½œçš„*"),s("em",[a._v("åŸå­æ€§")])])]),a._v(" "),s("li",[s("strong",[a._v("final")]),a._v(" - é€šè¿‡ç¦æ­¢"),s("strong",[a._v("åœ¨æ„é€ å‡½æ•°åˆå§‹åŒ–")]),a._v("å’Œ"),s("strong",[a._v("ç»™ final å­—æ®µèµ‹å€¼")]),a._v("è¿™ä¸¤ä¸ªåŠ¨ä½œçš„é‡æ’åºï¼Œä¿è¯"),s("strong",[a._v("å¯è§æ€§")]),a._v("ï¼ˆå¦‚æœ "),s("strong",[a._v("this å¼•ç”¨é€ƒé€¸")]),a._v("å°±ä¸å¥½è¯´å¯è§æ€§äº†ï¼‰")])]),a._v(" "),s("p",[a._v("ç¼–è¯‘å™¨åœ¨é‡åˆ°è¿™äº›å…³é”®å­—æ—¶ï¼Œä¼šæ’å…¥ç›¸åº”çš„å†…å­˜å±éšœï¼Œä¿è¯è¯­ä¹‰çš„æ­£ç¡®æ€§ã€‚")]),a._v(" "),s("p",[a._v("æœ‰ä¸€ç‚¹éœ€è¦"),s("strong",[a._v("æ³¨æ„")]),a._v("çš„æ˜¯ï¼Œ"),s("strong",[a._v("synchronized")]),a._v(" "),s("strong",[a._v("ä¸ä¿è¯")]),a._v("åŒæ­¥å—å†…çš„ä»£ç ç¦æ­¢é‡æ’åºï¼Œå› ä¸ºå®ƒé€šè¿‡é”ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰"),s("strong",[a._v("ä¸€ä¸ªçº¿ç¨‹")]),a._v("è®¿é—®åŒæ­¥å—ï¼ˆæˆ–ä¸´ç•ŒåŒºï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´åŒæ­¥å—çš„ä»£ç åªéœ€æ»¡è¶³ "),s("strong",[a._v("as-if-serial")]),a._v(" è¯­ä¹‰ - åªè¦å•çº¿ç¨‹çš„æ‰§è¡Œç»“æœä¸æ”¹å˜ï¼Œå¯ä»¥è¿›è¡Œé‡æ’åºã€‚")]),a._v(" "),s("p",[a._v("æ‰€ä»¥è¯´ï¼ŒJava å†…å­˜æ¨¡å‹æè¿°çš„æ˜¯å¤šçº¿ç¨‹å¯¹å…±äº«å†…å­˜ä¿®æ”¹åå½¼æ­¤ä¹‹é—´çš„å¯è§æ€§ï¼Œå¦å¤–ï¼Œè¿˜ç¡®ä¿æ­£ç¡®åŒæ­¥çš„ Java ä»£ç å¯ä»¥åœ¨ä¸åŒä½“ç³»ç»“æ„çš„å¤„ç†å™¨ä¸Šæ­£ç¡®è¿è¡Œã€‚")]),a._v(" "),s("h2",{attrs:{id:"_3-heap-å’Œstack-æœ‰ä»€ä¹ˆåŒºåˆ«"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-heap-å’Œstack-æœ‰ä»€ä¹ˆåŒºåˆ«"}},[a._v("#")]),a._v(" 3. heap å’Œstack æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ")]),a._v(" "),s("p",[s("strong",[a._v("ï¼ˆ1")]),a._v("ï¼‰ç”³è¯·æ–¹å¼")]),a._v(" "),s("p",[a._v("stack:ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ã€‚ä¾‹å¦‚ï¼Œå£°æ˜åœ¨å‡½æ•°ä¸­ä¸€ä¸ªå±€éƒ¨å˜é‡ int b; ç³»ç»Ÿè‡ªåŠ¨åœ¨æ ˆä¸­ä¸º b å¼€è¾Ÿç©ºé—´")]),a._v(" "),s("p",[a._v("heap:éœ€è¦ç¨‹åºå‘˜è‡ªå·±ç”³è¯·ï¼Œå¹¶æŒ‡æ˜å¤§å°ï¼Œåœ¨ c ä¸­ malloc å‡½æ•°ï¼Œå¯¹äºJava éœ€è¦æ‰‹åŠ¨ new Object()çš„å½¢å¼å¼€è¾Ÿ")]),a._v(" "),s("p",[s("strong",[a._v("ï¼ˆ2")]),a._v("ï¼‰ç”³è¯·åç³»ç»Ÿçš„å“åº”")]),a._v(" "),s("p",[a._v("stackï¼šåªè¦æ ˆçš„å‰©ä½™ç©ºé—´å¤§äºæ‰€ç”³è¯·ç©ºé—´ï¼Œç³»ç»Ÿå°†ä¸ºç¨‹åºæä¾›å†…å­˜ï¼Œå¦åˆ™å°†æŠ¥å¼‚å¸¸æç¤ºæ ˆæº¢å‡ºã€‚")]),a._v(" "),s("p",[a._v("heapï¼šé¦–å…ˆåº”è¯¥çŸ¥é“æ“ä½œç³»ç»Ÿæœ‰ä¸€ä¸ªè®°å½•ç©ºé—²å†…å­˜åœ°å€çš„é“¾è¡¨ï¼Œå½“ç³»ç»Ÿæ”¶åˆ°ç¨‹åºçš„ç”³è¯·æ—¶ï¼Œä¼šéå†è¯¥é“¾è¡¨ï¼Œå¯»æ‰¾ç¬¬ä¸€ä¸ªç©ºé—´å¤§äºæ‰€ç”³è¯·ç©ºé—´çš„å †ç»“ç‚¹ï¼Œç„¶åå°†è¯¥ç»“ç‚¹ä»ç©ºé—²ç»“ç‚¹é“¾è¡¨ä¸­åˆ é™¤ï¼Œå¹¶å°†è¯¥ç»“ç‚¹çš„ç©ºé—´åˆ†é…ç»™ç¨‹åºã€‚å¦å¤–ï¼Œç”±äºæ‰¾åˆ°çš„å †ç»“ç‚¹çš„å¤§å°ä¸ä¸€å®šæ­£å¥½ç­‰äºç”³è¯·çš„å¤§å°ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨çš„å°†å¤šä½™çš„é‚£éƒ¨åˆ†é‡æ–°æ”¾å…¥ç©ºé—²é“¾è¡¨ä¸­ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("ï¼ˆ3")]),a._v("ï¼‰ç”³è¯·å¤§å°çš„é™åˆ¶")]),a._v(" "),s("p",[a._v("stackï¼šæ ˆæ˜¯å‘ä½åœ°å€æ‰©å±•çš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€å—è¿ç»­çš„å†…å­˜çš„åŒºåŸŸã€‚è¿™å¥è¯çš„æ„æ€æ˜¯æ ˆé¡¶çš„åœ°å€å’Œæ ˆçš„æœ€å¤§å®¹é‡æ˜¯ç³»ç»Ÿé¢„å…ˆè§„å®šå¥½çš„ï¼Œåœ¨ WINDOWS ä¸‹ï¼Œæ ˆçš„å¤§å°æ˜¯ 2Mï¼ˆé»˜è®¤å€¼ä¹Ÿå–å†³äºè™šæ‹Ÿå†…å­˜çš„å¤§å°ï¼‰ï¼Œå¦‚æœç”³è¯·çš„ç©ºé—´è¶…è¿‡æ ˆçš„å‰©ä½™ç©ºé—´æ—¶ï¼Œå°†æç¤º overflowã€‚å› æ­¤ï¼Œèƒ½ä»æ ˆè·å¾—çš„ç©ºé—´è¾ƒå°ã€‚")]),a._v(" "),s("p",[a._v("heapï¼šå †æ˜¯å‘é«˜åœ°å€æ‰©å±•çš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸è¿ç»­çš„å†…å­˜åŒºåŸŸã€‚è¿™æ˜¯ç”±äºç³»ç»Ÿæ˜¯ç”¨é“¾è¡¨æ¥å­˜å‚¨çš„ç©ºé—²å†…å­˜åœ°å€çš„ï¼Œ è‡ªç„¶æ˜¯ä¸è¿ç»­çš„ï¼Œè€Œé“¾è¡¨çš„éå†æ–¹å‘æ˜¯ç”±ä½åœ°å€å‘é«˜åœ°å€ã€‚å †çš„å¤§å°å—é™äºè®¡ç®—æœºç³»ç»Ÿä¸­æœ‰æ•ˆçš„è™šæ‹Ÿå†…å­˜ã€‚ç”±æ­¤å¯è§ï¼Œ å †è·å¾—çš„ç©ºé—´æ¯”è¾ƒçµæ´»ï¼Œä¹Ÿæ¯”è¾ƒå¤§ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("ï¼ˆ4")]),a._v("ï¼‰ç”³è¯·æ•ˆç‡çš„æ¯”è¾ƒ")]),a._v(" "),s("p",[a._v("stackï¼šç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ï¼Œé€Ÿåº¦è¾ƒå¿«ã€‚ä½†ç¨‹åºå‘˜æ˜¯æ— æ³•æ§åˆ¶çš„ã€‚")]),a._v(" "),s("p",[a._v("heapï¼šç”± new åˆ†é…çš„å†…å­˜ï¼Œä¸€èˆ¬é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè€Œä¸”å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡,ä¸è¿‡ç”¨èµ·æ¥æœ€æ–¹ä¾¿ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("ï¼ˆ5")]),a._v("ï¼‰heapå’Œstackä¸­çš„å­˜å‚¨å†…å®¹")]),a._v(" "),s("p",[a._v("stackï¼šåœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œç¬¬ä¸€ä¸ªè¿›æ ˆçš„æ˜¯ä¸»å‡½æ•°ä¸­åçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼ˆå‡½æ•°è°ƒç”¨è¯­å¥çš„ä¸‹ä¸€æ¡å¯æ‰§è¡Œè¯­å¥ï¼‰çš„åœ°å€ï¼Œ ç„¶åæ˜¯å‡½æ•°çš„å„ä¸ªå‚æ•°ï¼Œåœ¨å¤§å¤šæ•°çš„ C ç¼–è¯‘å™¨ä¸­ï¼Œå‚æ•°æ˜¯ç”±å³å¾€å·¦å…¥æ ˆçš„ï¼Œç„¶åæ˜¯å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ã€‚æ³¨æ„é™æ€å˜é‡æ˜¯ä¸å…¥æ ˆçš„ã€‚")]),a._v(" "),s("p",[a._v("å½“æœ¬æ¬¡å‡½æ•°è°ƒç”¨ç»“æŸåï¼Œå±€éƒ¨å˜é‡å…ˆå‡ºæ ˆï¼Œç„¶åæ˜¯å‚æ•°ï¼Œæœ€åæ ˆé¡¶æŒ‡é’ˆæŒ‡å‘æœ€å¼€å§‹å­˜çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä¸»å‡½æ•°ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œç¨‹åºç”±è¯¥ç‚¹ç»§ç»­è¿è¡Œã€‚")]),a._v(" "),s("p",[a._v("heapï¼šä¸€èˆ¬æ˜¯åœ¨å †çš„å¤´éƒ¨ç”¨ä¸€ä¸ªå­—èŠ‚å­˜æ”¾å †çš„å¤§å°ã€‚å †ä¸­çš„å…·ä½“å†…å®¹æœ‰ç¨‹åºå‘˜å®‰æ’ã€‚")]),a._v(" "),s("h2",{attrs:{id:"_4-ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿæ ˆå†…å­˜æº¢å‡º"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿæ ˆå†…å­˜æº¢å‡º"}},[a._v("#")]),a._v(" 4. ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿæ ˆå†…å­˜æº¢å‡ºï¼Ÿ")]),a._v(" "),s("p",[a._v("1ã€æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ ˆçš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ä¸€æ ·ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™å°±ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œå®ƒåŒ…å«å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ï¼Œå±€éƒ¨å˜é‡è¡¨åˆåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡çš„å¼•ç”¨ï¼›\n2ã€å½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦è¶…è¿‡äº†è™šæ‹Ÿæœºå…è®¸çš„æœ€å¤§æ·±åº¦æ—¶ï¼Œä¼šæŠ›å‡ºStackOverFlowErrorå¼‚å¸¸ï¼Œæ–¹æ³•é€’å½’è°ƒç”¨è‚¯å¯èƒ½ä¼šå‡ºç°è¯¥é—®é¢˜ï¼›\n3ã€è°ƒæ•´å‚æ•°-xsså»è°ƒæ•´jvmæ ˆçš„å¤§å°")]),a._v(" "),s("h2",{attrs:{id:"_5-è°ˆè°ˆå¯¹-oom-çš„è®¤è¯†-å¦‚ä½•æ’æŸ¥-oom-çš„é—®é¢˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-è°ˆè°ˆå¯¹-oom-çš„è®¤è¯†-å¦‚ä½•æ’æŸ¥-oom-çš„é—®é¢˜"}},[a._v("#")]),a._v(" 5. è°ˆè°ˆå¯¹ OOM çš„è®¤è¯†ï¼Ÿå¦‚ä½•æ’æŸ¥ OOM çš„é—®é¢˜ï¼Ÿ")]),a._v(" "),s("p",[a._v("é™¤äº†ç¨‹åºè®¡æ•°å™¨ï¼Œå…¶ä»–å†…å­˜åŒºåŸŸéƒ½æœ‰ OOM çš„é£é™©ã€‚")]),a._v(" "),s("ul",[s("li",[a._v("æ ˆä¸€èˆ¬ç»å¸¸ä¼šå‘ç”Ÿ StackOverflowErrorï¼Œæ¯”å¦‚ 32 ä½çš„ windows ç³»ç»Ÿå•è¿›ç¨‹é™åˆ¶ 2G å†…å­˜ï¼Œæ— é™åˆ›å»ºçº¿ç¨‹å°±ä¼šå‘ç”Ÿæ ˆçš„ OOM")]),a._v(" "),s("li",[a._v("Java 8 å¸¸é‡æ± ç§»åˆ°å †ä¸­ï¼Œæº¢å‡ºä¼šå‡º java.lang.OutOfMemoryError: Java heap spaceï¼Œè®¾ç½®æœ€å¤§å…ƒç©ºé—´å¤§å°å‚æ•°æ— æ•ˆï¼›")]),a._v(" "),s("li",[a._v("å †å†…å­˜æº¢å‡ºï¼ŒæŠ¥é”™åŒä¸Šï¼Œè¿™ç§æ¯”è¾ƒå¥½ç†è§£ï¼ŒGC ä¹‹åæ— æ³•åœ¨å †ä¸­ç”³è¯·å†…å­˜åˆ›å»ºå¯¹è±¡å°±ä¼šæŠ¥é”™ï¼›")]),a._v(" "),s("li",[a._v("æ–¹æ³•åŒº OOMï¼Œç»å¸¸ä¼šé‡åˆ°çš„æ˜¯åŠ¨æ€ç”Ÿæˆå¤§é‡çš„ç±»ã€jsp ç­‰ï¼›")]),a._v(" "),s("li",[a._v("ç›´æ¥å†…å­˜ OOMï¼Œæ¶‰åŠåˆ° -XX:MaxDirectMemorySize å‚æ•°å’Œ Unsafe å¯¹è±¡å¯¹å†…å­˜çš„ç”³è¯·ã€‚")])]),a._v(" "),s("p",[a._v("æ’æŸ¥ OOM çš„æ–¹æ³•ï¼š")]),a._v(" "),s("ul",[s("li",[a._v("å¢åŠ ä¸¤ä¸ªå‚æ•° -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp/heapdump.hprofï¼Œå½“ OOM å‘ç”Ÿæ—¶è‡ªåŠ¨ dump å †å†…å­˜ä¿¡æ¯åˆ°æŒ‡å®šç›®å½•ï¼›")]),a._v(" "),s("li",[a._v("åŒæ—¶ jstat æŸ¥çœ‹ç›‘æ§ JVM çš„å†…å­˜å’Œ GC æƒ…å†µï¼Œå…ˆè§‚å¯Ÿé—®é¢˜å¤§æ¦‚å‡ºåœ¨ä»€ä¹ˆåŒºåŸŸï¼›")]),a._v(" "),s("li",[a._v("ä½¿ç”¨ MAT å·¥å…·è½½å…¥åˆ° dump æ–‡ä»¶ï¼Œåˆ†æå¤§å¯¹è±¡çš„å ç”¨æƒ…å†µï¼Œæ¯”å¦‚ HashMap åšç¼“å­˜æœªæ¸…ç†ï¼Œæ—¶é—´é•¿äº†å°±ä¼šå†…å­˜æº¢å‡ºï¼Œå¯ä»¥æŠŠæ”¹ä¸ºå¼±å¼•ç”¨ ã€‚")])]),a._v(" "),s("h2",{attrs:{id:"_6-è°ˆè°ˆ-jvm-ä¸­çš„å¸¸é‡æ± "}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-è°ˆè°ˆ-jvm-ä¸­çš„å¸¸é‡æ± "}},[a._v("#")]),a._v(" 6. è°ˆè°ˆ JVM ä¸­çš„å¸¸é‡æ± ï¼Ÿ")]),a._v(" "),s("p",[a._v("JVMå¸¸é‡æ± ä¸»è¦åˆ†ä¸º"),s("strong",[a._v("Classæ–‡ä»¶å¸¸é‡æ± ã€è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå…¨å±€å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œä»¥åŠåŸºæœ¬ç±»å‹åŒ…è£…ç±»å¯¹è±¡å¸¸é‡æ± ")]),a._v("ã€‚")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("Classæ–‡ä»¶å¸¸é‡æ± ")]),a._v("ã€‚classæ–‡ä»¶æ˜¯ä¸€ç»„ä»¥å­—èŠ‚ä¸ºå•ä½çš„äºŒè¿›åˆ¶æ•°æ®æµï¼Œåœ¨javaä»£ç çš„ç¼–è¯‘æœŸé—´ï¼Œæˆ‘ä»¬ç¼–å†™çš„javaæ–‡ä»¶å°±è¢«ç¼–è¯‘ä¸º.classæ–‡ä»¶æ ¼å¼çš„äºŒè¿›åˆ¶æ•°æ®å­˜æ”¾åœ¨ç£ç›˜ä¸­ï¼Œå…¶ä¸­å°±åŒ…æ‹¬classæ–‡ä»¶å¸¸é‡æ± ã€‚")]),a._v(" "),s("li",[s("strong",[a._v("è¿è¡Œæ—¶å¸¸é‡æ± ")]),a._v("ï¼šè¿è¡Œæ—¶å¸¸é‡æ± ç›¸å¯¹äºclasså¸¸é‡æ± ä¸€å¤§ç‰¹å¾å°±æ˜¯å…·æœ‰åŠ¨æ€æ€§ï¼Œjavaè§„èŒƒå¹¶ä¸è¦æ±‚å¸¸é‡åªèƒ½åœ¨è¿è¡Œæ—¶æ‰äº§ç”Ÿï¼Œä¹Ÿå°±æ˜¯è¯´è¿è¡Œæ—¶å¸¸é‡æ± çš„å†…å®¹å¹¶ä¸å…¨éƒ¨æ¥è‡ªclasså¸¸é‡æ± ï¼Œåœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡ä»£ç ç”Ÿæˆå¸¸é‡å¹¶å°†å…¶æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œè¿™ç§ç‰¹æ€§è¢«ç”¨çš„æœ€å¤šçš„å°±æ˜¯String.intern()ã€‚")]),a._v(" "),s("li",[s("strong",[a._v("å…¨å±€å­—ç¬¦ä¸²å¸¸é‡æ± ")]),a._v("ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯JVMæ‰€ç»´æŠ¤çš„ä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨è¡¨ï¼Œåœ¨HotSpot VMä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªå«åšStringTableçš„å…¨å±€è¡¨ã€‚åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç»´æŠ¤çš„æ˜¯å­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨ï¼Œåº•å±‚C++å®ç°å°±æ˜¯ä¸€ä¸ªHashtableã€‚è¿™äº›è¢«ç»´æŠ¤çš„å¼•ç”¨æ‰€æŒ‡çš„å­—ç¬¦ä¸²å®ä¾‹ï¼Œè¢«ç§°ä½œâ€è¢«é©»ç•™çš„å­—ç¬¦ä¸²â€æˆ–â€interned stringâ€æˆ–é€šå¸¸æ‰€è¯´çš„â€è¿›å…¥äº†å­—ç¬¦ä¸²å¸¸é‡æ± çš„å­—ç¬¦ä¸²â€ã€‚")]),a._v(" "),s("li",[a._v("åŸºæœ¬ç±»å‹åŒ…è£…ç±»å¯¹è±¡å¸¸é‡æ± ï¼šjavaä¸­åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»çš„å¤§éƒ¨åˆ†éƒ½å®ç°äº†å¸¸é‡æ± æŠ€æœ¯ï¼Œè¿™äº›ç±»æ˜¯Byte,Short,Integer,Long,Character,Boolean,å¦å¤–ä¸¤ç§æµ®ç‚¹æ•°ç±»å‹çš„åŒ…è£…ç±»åˆ™æ²¡æœ‰å®ç°ã€‚å¦å¤–ä¸Šé¢è¿™5ç§æ•´å‹çš„åŒ…è£…ç±»ä¹Ÿåªæ˜¯åœ¨å¯¹åº”å€¼å°äºç­‰äº127æ—¶æ‰å¯ä½¿ç”¨å¯¹è±¡æ± ï¼Œä¹Ÿå³å¯¹è±¡ä¸è´Ÿè´£åˆ›å»ºå’Œç®¡ç†å¤§äº127çš„è¿™äº›ç±»çš„å¯¹è±¡ã€‚")])]),a._v(" "),s("h2",{attrs:{id:"_7-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´»"}},[a._v("#")]),a._v(" 7. å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Ÿ")]),a._v(" "),s("p",[a._v("åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œåˆ†ä¸ºä¸¤ç§ç®—æ³•1ï¼šå¼•ç”¨è®¡æ•°æ³•ï¼›2ï¼šå¯è¾¾æ€§åˆ†æç®—æ³•ï¼›")]),a._v(" "),s("p",[s("strong",[a._v("å¼•ç”¨è®¡æ•°æ³•")]),a._v("ï¼š\nç»™æ¯ä¸€ä¸ªå¯¹è±¡è®¾ç½®ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨è¯¥å¯¹è±¡çš„æ—¶å€™ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±+1ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±-1ï¼›å½“å¼•ç”¨è®¡æ•°å™¨ä¸º0çš„æ—¶å€™ï¼Œå°±è¯´æ˜è¿™ä¸ªå¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾å¯¹è±¡ï¼Œç­‰å¾…å›æ”¶ï¼›\nç¼ºç‚¹ï¼šæ— æ³•è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå½“Aå¼•ç”¨Bï¼ŒBä¹Ÿå¼•ç”¨Açš„æ—¶å€™ï¼Œæ­¤æ—¶ABå¯¹è±¡çš„å¼•ç”¨éƒ½ä¸ä¸º0ï¼Œæ­¤æ—¶ä¹Ÿå°±æ— æ³•åƒåœ¾å›æ”¶ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸»æµè™šæ‹Ÿæœºéƒ½ä¸é‡‡ç”¨è¿™ä¸ªæ–¹æ³•ï¼›")]),a._v(" "),s("p",[s("strong",[a._v("å¯è¾¾æ€§åˆ†ææ³•")]),a._v("\nä»ä¸€ä¸ªè¢«ç§°ä¸ºGC Rootsçš„å¯¹è±¡å‘ä¸‹æœç´¢ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ¥æ—¶ï¼Œè¯´æ˜æ­¤å¯¹è±¡ä¸å¯ç”¨ï¼Œåœ¨javaä¸­å¯ä»¥ä½œä¸ºGC Rootsçš„å¯¹è±¡æœ‰ä»¥ä¸‹å‡ ç§ï¼š")]),a._v(" "),s("ul",[s("li",[a._v("è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡")]),a._v(" "),s("li",[a._v("æ–¹æ³•åŒºç±»é™æ€å±æ€§å¼•ç”¨çš„å˜é‡")]),a._v(" "),s("li",[a._v("æ–¹æ³•åŒºå¸¸é‡æ± å¼•ç”¨çš„å¯¹è±¡")]),a._v(" "),s("li",[a._v("æœ¬åœ°æ–¹æ³•æ ˆJNIå¼•ç”¨çš„å¯¹è±¡")])]),a._v(" "),s("p",[a._v("ä½†ä¸€ä¸ªå¯¹è±¡æ»¡è¶³ä¸Šè¿°æ¡ä»¶çš„æ—¶å€™ï¼Œä¸ä¼šé©¬ä¸Šè¢«å›æ”¶ï¼Œè¿˜éœ€è¦è¿›è¡Œä¸¤æ¬¡æ ‡è®°ï¼›ç¬¬ä¸€æ¬¡æ ‡è®°ï¼šåˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦æœ‰finalize()æ–¹æ³•å¹¶ä¸”è¯¥æ–¹æ³•æ²¡æœ‰è¢«æ‰§è¡Œè¿‡ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ ‡è®°ä¸ºåƒåœ¾å¯¹è±¡ï¼Œç­‰å¾…å›æ”¶ï¼›è‹¥æœ‰çš„è¯ï¼Œåˆ™è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ï¼›ç¬¬äºŒæ¬¡æ ‡è®°å°†å½“å‰å¯¹è±¡æ”¾å…¥F-Queueé˜Ÿåˆ—ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªfinalizeçº¿ç¨‹å»æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œè™šæ‹Ÿæœºä¸ä¿è¯è¯¥æ–¹æ³•ä¸€å®šä¼šè¢«æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœçº¿ç¨‹æ‰§è¡Œç¼“æ…¢æˆ–è¿›å…¥äº†æ­»é”ï¼Œä¼šå¯¼è‡´å›æ”¶ç³»ç»Ÿçš„å´©æºƒï¼›å¦‚æœæ‰§è¡Œäº†finalizeæ–¹æ³•ä¹‹åä»ç„¶æ²¡æœ‰ä¸GC Rootsæœ‰ç›´æ¥æˆ–è€…é—´æ¥çš„å¼•ç”¨ï¼Œåˆ™è¯¥å¯¹è±¡ä¼šè¢«å›æ”¶ï¼›")]),a._v(" "),s("h2",{attrs:{id:"_8-å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨æ˜¯ä»€ä¹ˆ-æœ‰ä»€ä¹ˆåŒºåˆ«"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨æ˜¯ä»€ä¹ˆ-æœ‰ä»€ä¹ˆåŒºåˆ«"}},[a._v("#")]),a._v(" 8. å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ")]),a._v(" "),s("ul",[s("li",[a._v('å¼ºå¼•ç”¨ï¼Œå°±æ˜¯æ™®é€šçš„å¯¹è±¡å¼•ç”¨å…³ç³»ï¼Œå¦‚ String s = new String("ConstXiong")')]),a._v(" "),s("li",[a._v("è½¯å¼•ç”¨ï¼Œç”¨äºç»´æŠ¤ä¸€äº›å¯æœ‰å¯æ— çš„å¯¹è±¡ã€‚åªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿåˆ™ä¼šå›æ”¶è½¯å¼•ç”¨å¯¹è±¡ï¼Œå¦‚æœå›æ”¶äº†è½¯å¼•ç”¨å¯¹è±¡ä¹‹åä»ç„¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚SoftReference å®ç°")]),a._v(" "),s("li",[a._v("å¼±å¼•ç”¨ï¼Œç›¸æ¯”è½¯å¼•ç”¨æ¥è¯´ï¼Œè¦æ›´åŠ æ— ç”¨ä¸€äº›ï¼Œå®ƒæ‹¥æœ‰æ›´çŸ­çš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“ JVM è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚WeakReference å®ç°")]),a._v(" "),s("li",[a._v("è™šå¼•ç”¨æ˜¯ä¸€ç§å½¢åŒè™šè®¾çš„å¼•ç”¨ï¼Œåœ¨ç°å®åœºæ™¯ä¸­ç”¨çš„ä¸æ˜¯å¾ˆå¤šï¼Œå®ƒä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨ã€‚PhantomReference å®ç°")])]),a._v(" "),s("h2",{attrs:{id:"_9-è¢«å¼•ç”¨çš„å¯¹è±¡å°±ä¸€å®šèƒ½å­˜æ´»å—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-è¢«å¼•ç”¨çš„å¯¹è±¡å°±ä¸€å®šèƒ½å­˜æ´»å—"}},[a._v("#")]),a._v(" 9. è¢«å¼•ç”¨çš„å¯¹è±¡å°±ä¸€å®šèƒ½å­˜æ´»å—ï¼Ÿ")]),a._v(" "),s("blockquote",[s("p",[a._v("ä¸ä¸€å®šï¼Œçœ‹ Reference ç±»å‹ï¼Œå¼±å¼•ç”¨åœ¨ GC æ—¶ä¼šè¢«å›æ”¶ï¼Œè½¯å¼•ç”¨åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼Œå³ OOM å‰ä¼šè¢«å›æ”¶ï¼Œä½†å¦‚æœæ²¡æœ‰åœ¨ Reference Chain ä¸­çš„å¯¹è±¡å°±ä¸€å®šä¼šè¢«å›æ”¶ã€‚")])]),a._v(" "),s("h2",{attrs:{id:"_10-javaä¸­çš„åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-javaä¸­çš„åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›"}},[a._v("#")]),a._v(" 10. Javaä¸­çš„åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ")]),a._v(" "),s("p",[a._v("javaä¸­æœ‰å››ç§åƒåœ¾å›æ”¶ç®—æ³•ï¼Œåˆ†åˆ«æ˜¯æ ‡è®°æ¸…é™¤æ³•ã€æ ‡è®°æ•´ç†æ³•ã€å¤åˆ¶ç®—æ³•ã€åˆ†ä»£æ”¶é›†ç®—æ³•ï¼›\n"),s("strong",[a._v("æ ‡è®°æ¸…é™¤æ³•")]),a._v("ï¼š\nç¬¬ä¸€æ­¥ï¼šåˆ©ç”¨å¯è¾¾æ€§å»éå†å†…å­˜ï¼ŒæŠŠå­˜æ´»å¯¹è±¡å’Œåƒåœ¾å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼›\nç¬¬äºŒæ­¥ï¼šåœ¨éå†ä¸€éï¼Œå°†æ‰€æœ‰æ ‡è®°çš„å¯¹è±¡å›æ”¶æ‰ï¼›\nç‰¹ç‚¹ï¼šæ•ˆç‡ä¸è¡Œï¼Œæ ‡è®°å’Œæ¸…é™¤çš„æ•ˆç‡éƒ½ä¸é«˜ï¼›æ ‡è®°å’Œæ¸…é™¤åä¼šäº§ç”Ÿå¤§é‡çš„ä¸è¿ç»­çš„ç©ºé—´åˆ†ç‰‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¹‹åç¨‹åºè¿è¡Œçš„æ—¶å€™éœ€åˆ†é…å¤§å¯¹è±¡è€Œæ‰¾ä¸åˆ°è¿ç»­åˆ†ç‰‡è€Œä¸å¾—ä¸è§¦å‘ä¸€æ¬¡GCï¼›")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210220111918592.png",alt:""}})]),a._v(" "),s("p",[s("strong",[a._v("æ ‡è®°æ•´ç†æ³•")]),a._v("ï¼š\nç¬¬ä¸€æ­¥ï¼šåˆ©ç”¨å¯è¾¾æ€§å»éå†å†…å­˜ï¼ŒæŠŠå­˜æ´»å¯¹è±¡å’Œåƒåœ¾å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼›\nç¬¬äºŒæ­¥ï¼šå°†æ‰€æœ‰çš„å­˜æ´»çš„å¯¹è±¡å‘ä¸€æ®µç§»åŠ¨ï¼Œå°†ç«¯è¾¹ç•Œä»¥å¤–çš„å¯¹è±¡éƒ½å›æ”¶æ‰ï¼›\nç‰¹ç‚¹ï¼šé€‚ç”¨äºå­˜æ´»å¯¹è±¡å¤šï¼Œåƒåœ¾å°‘çš„æƒ…å†µï¼›éœ€è¦æ•´ç†çš„è¿‡ç¨‹ï¼Œæ— ç©ºé—´ç¢ç‰‡äº§ç”Ÿï¼›")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210220111933505.png",alt:""}})]),a._v(" "),s("p",[s("strong",[a._v("å¤åˆ¶ç®—æ³•")]),a._v("ï¼š\nå°†å†…å­˜æŒ‰ç…§å®¹é‡å¤§å°åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨ä¸€å—ï¼Œå½“ä¸€å—ä½¿ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡ç§»åˆ°å¦ä¸€å—ä¸Šï¼Œç„¶ååœ¨æŠŠä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ç§»é™¤ï¼›\nç‰¹ç‚¹ï¼šä¸ä¼šäº§ç”Ÿç©ºé—´ç¢ç‰‡ï¼›å†…å­˜ä½¿ç”¨ç‡æä½ï¼›")]),a._v(" "),s("p",[s("strong",[a._v("åˆ†ä»£æ”¶é›†ç®—æ³•")]),a._v("ï¼š\næ ¹æ®å†…å­˜å¯¹è±¡çš„å­˜æ´»å‘¨æœŸä¸åŒï¼Œå°†å†…å­˜åˆ’åˆ†æˆå‡ å—ï¼Œjavaè™šæ‹Ÿæœºä¸€èˆ¬å°†å†…å­˜åˆ†æˆæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæœ‰å¤§é‡å¯¹è±¡æ­»å»å’Œå°‘é‡å¯¹è±¡å­˜æ´»ï¼Œæ‰€ä»¥é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›†ï¼›è€å¹´ä»£ä¸­å› ä¸ºå¯¹è±¡çš„å­˜æ´»ç‡æé«˜ï¼Œæ²¡æœ‰é¢å¤–çš„ç©ºé—´å¯¹ä»–è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œæ‰€ä»¥é‡‡ç”¨æ ‡è®°æ¸…ç†æˆ–è€…æ ‡è®°æ•´ç†ç®—æ³•è¿›è¡Œå›æ”¶ï¼›")]),a._v(" "),s("p",[s("strong",[a._v("å¯¹æ¯”")])]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210329224002527.png",alt:"image-20210329224002527"}})]),a._v(" "),s("h2",{attrs:{id:"_11-æœ‰å“ªå‡ ç§åƒåœ¾å›æ”¶å™¨-å„è‡ªçš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-æœ‰å“ªå‡ ç§åƒåœ¾å›æ”¶å™¨-å„è‡ªçš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆ"}},[a._v("#")]),a._v(" 11. æœ‰å“ªå‡ ç§åƒåœ¾å›æ”¶å™¨ï¼Œå„è‡ªçš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ")]),a._v(" "),s("p",[a._v("åƒåœ¾å›æ”¶å™¨ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼šSerialã€ParNewã€Parallel Scavengeã€Serial Oldã€Parallel Oldã€CMSã€G1ï¼›")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("Serial:å•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œæ”¶é›†åƒåœ¾æ—¶ï¼Œå¿…é¡»stop the worldï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ã€‚å®ƒçš„æœ€å¤§ç‰¹ç‚¹æ˜¯åœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œéœ€è¦å¯¹æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æš‚åœï¼ˆstop the worldï¼‰ï¼Œå¯¹äºæœ‰äº›åº”ç”¨æ˜¯éš¾ä»¥æ¥å—çš„ï¼Œä½†æ˜¯å¦‚æœåº”ç”¨çš„å®æ—¶æ€§è¦æ±‚ä¸æ˜¯é‚£ä¹ˆé«˜ï¼Œåªè¦åœé¡¿çš„æ—¶é—´æ§åˆ¶åœ¨Næ¯«ç§’ä¹‹å†…ï¼Œå¤§å¤šæ•°åº”ç”¨è¿˜æ˜¯å¯ä»¥æ¥å—çš„ï¼Œæ˜¯clientçº§åˆ«çš„é»˜è®¤GCæ–¹å¼ã€‚")])]),a._v(" "),s("li",[s("p",[a._v("ParNew:Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œä¹Ÿéœ€è¦stop the worldï¼Œå¤åˆ¶ç®—")])]),a._v(" "),s("li",[s("p",[a._v("Parallel Scavenge:æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå¤åˆ¶ç®—æ³•çš„æ”¶é›†å™¨ï¼Œå¹¶å‘çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼Œç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§çš„ååé‡ï¼Œå’ŒParNewçš„æœ€å¤§åŒºåˆ«æ˜¯GCè‡ªåŠ¨è°ƒèŠ‚ç­–ç•¥ï¼›è™šæ‹Ÿæœºä¼šæ ¹æ®ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€æ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è®¾ç½®è¿™äº›å‚æ•°ï¼Œä»¥æä¾›æœ€ä¼˜åœé¡¿æ—¶é—´å’Œæœ€é«˜çš„ååé‡ï¼›")])]),a._v(" "),s("li",[s("p",[a._v("Serial Old:Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨æ ‡è®°æ•´ç†ç®—æ³•ã€‚")])]),a._v(" "),s("li",[s("p",[a._v("Parallel Oldï¼šæ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•ã€‚")])]),a._v(" "),s("li",[s("p",[a._v("CMS:æ˜¯ä¸€ç§ä»¥è·å¾—æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œæ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œè¿ä½œè¿‡ç¨‹ï¼šåˆå§‹æ ‡è®°ï¼Œå¹¶å‘æ ‡è®°ï¼Œé‡æ–°æ ‡è®°ï¼Œå¹¶å‘æ¸…é™¤ï¼Œæ”¶é›†ç»“æŸä¼šäº§ç”Ÿå¤§é‡ç©ºé—´ç¢ç‰‡ï¼›")])]),a._v(" "),s("li",[s("p",[a._v("G1:æ ‡è®°æ•´ç†ç®—æ³•å®ç°ï¼Œè¿ä½œæµç¨‹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ï¼šåˆå§‹æ ‡è®°ï¼Œå¹¶å‘æ ‡è®°ï¼Œæœ€ç»ˆæ ‡è®°ï¼Œç­›é€‰å›æ”¶ã€‚ä¸ä¼šäº§ç”Ÿç©ºé—´ç¢ç‰‡ï¼Œå¯ä»¥ç²¾ç¡®åœ°æ§åˆ¶åœé¡¿ï¼›G1å°†æ•´ä¸ªå †åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„å¤šä¸ªRegionï¼ˆåŒºåŸŸï¼‰ï¼ŒG1è·Ÿè¸ªæ¯ä¸ªåŒºåŸŸçš„åƒåœ¾å¤§å°ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§åˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„åŒºåŸŸï¼Œå·²è¾¾åˆ°åœ¨æœ‰é™æ—¶é—´å†…è·å–å°½å¯èƒ½é«˜çš„å›æ”¶æ•ˆç‡ï¼›")])])]),a._v(" "),s("p",[s("strong",[a._v("åƒåœ¾å›æ”¶å™¨é—´çš„é…åˆä½¿ç”¨å›¾ï¼š")])]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210329224424220.png",alt:""}})]),a._v(" "),s("p",[s("strong",[a._v("å„ä¸ªåƒåœ¾å›æ”¶å™¨å¯¹æ¯”")]),a._v("ï¼š")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210329230618579.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"_12-è¯¦ç»†è¯´ä¸€ä¸‹cmsçš„å›æ”¶è¿‡ç¨‹-cmsçš„é—®é¢˜æ˜¯ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-è¯¦ç»†è¯´ä¸€ä¸‹cmsçš„å›æ”¶è¿‡ç¨‹-cmsçš„é—®é¢˜æ˜¯ä»€ä¹ˆ"}},[a._v("#")]),a._v(" 12. è¯¦ç»†è¯´ä¸€ä¸‹CMSçš„å›æ”¶è¿‡ç¨‹ï¼ŸCMSçš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ")]),a._v(" "),s("p",[a._v("CMS(Concurrent Mark Sweepï¼Œå¹¶å‘æ ‡è®°æ¸…é™¤) æ”¶é›†å™¨æ˜¯ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼ˆè¿½æ±‚ä½åœé¡¿ï¼‰ï¼Œå®ƒåœ¨åƒåœ¾æ”¶é›†æ—¶ä½¿å¾—ç”¨æˆ·çº¿ç¨‹å’Œ GC çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå› æ­¤åœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­ç”¨æˆ·ä¹Ÿä¸ä¼šæ„Ÿåˆ°æ˜æ˜¾çš„å¡é¡¿ã€‚")]),a._v(" "),s("p",[a._v("ä»åå­—å°±å¯ä»¥çŸ¥é“ï¼ŒCMSæ˜¯åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„ã€‚CMS å›æ”¶è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å››æ­¥ï¼š")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("åˆå§‹æ ‡è®° ï¼ˆCMS initial mark)ï¼šä¸»è¦æ˜¯æ ‡è®° GC Root å¼€å§‹çš„ä¸‹çº§ï¼ˆæ³¨ï¼šä»…ä¸‹ä¸€çº§ï¼‰å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼š STWï¼Œä½†æ˜¯è·Ÿ GC Root ç›´æ¥å…³è”çš„ä¸‹çº§å¯¹è±¡ä¸ä¼šå¾ˆå¤šï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹å…¶å®å¾ˆå¿«ã€‚")])]),a._v(" "),s("li",[s("p",[a._v("å¹¶å‘æ ‡è®° (CMS concurrent mark)ï¼šæ ¹æ®ä¸Šä¸€æ­¥çš„ç»“æœï¼Œç»§ç»­å‘ä¸‹æ ‡è¯†æ‰€æœ‰å…³è”çš„å¯¹è±¡ï¼Œç›´åˆ°è¿™æ¡é“¾ä¸Šçš„æœ€å°½å¤´ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¤šçº¿ç¨‹çš„ï¼Œè™½ç„¶è€—æ—¶ç†è®ºä¸Šä¼šæ¯”è¾ƒé•¿ï¼Œä½†æ˜¯å…¶å®ƒå·¥ä½œçº¿ç¨‹å¹¶ä¸ä¼šé˜»å¡ï¼Œæ²¡æœ‰ STWã€‚")])]),a._v(" "),s("li",[s("p",[a._v("é‡æ–°æ ‡è®°ï¼ˆCMS remarkï¼‰ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯è¦å†æ ‡è®°ä¸€æ¬¡ã€‚ä¸ºå•¥è¿˜è¦å†æ ‡è®°ä¸€æ¬¡ï¼Ÿå› ä¸ºç¬¬ 2 æ­¥å¹¶æ²¡æœ‰é˜»å¡å…¶å®ƒå·¥ä½œçº¿ç¨‹ï¼Œå…¶å®ƒçº¿ç¨‹åœ¨æ ‡è¯†è¿‡ç¨‹ä¸­ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šäº§ç”Ÿæ–°çš„åƒåœ¾ã€‚")])]),a._v(" "),s("li",[s("p",[a._v("å¹¶å‘æ¸…é™¤ï¼ˆCMS concurrent sweepï¼‰ï¼šæ¸…é™¤é˜¶æ®µæ˜¯æ¸…ç†åˆ é™¤æ‰æ ‡è®°é˜¶æ®µåˆ¤æ–­çš„å·²ç»æ­»äº¡çš„å¯¹è±¡ï¼Œç”±äºä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘è¿›è¡Œçš„ã€‚")])])]),a._v(" "),s("p",[s("strong",[a._v("CMS çš„é—®é¢˜ï¼š")])]),a._v(" "),s("p",[s("strong",[a._v("1. å¹¶å‘å›æ”¶å¯¼è‡´CPUèµ„æºç´§å¼ ï¼š")])]),a._v(" "),s("p",[a._v("åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åœé¡¿ï¼Œä½†å´ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œé™ä½ç¨‹åºæ€»ååé‡ã€‚CMSé»˜è®¤å¯åŠ¨çš„å›æ”¶çº¿ç¨‹æ•°æ˜¯ï¼šï¼ˆCPUæ ¸æ•° + 3ï¼‰/ 4ï¼Œå½“CPUæ ¸æ•°ä¸è¶³å››ä¸ªæ—¶ï¼ŒCMSå¯¹ç”¨æˆ·ç¨‹åºçš„å½±å“å°±å¯èƒ½å˜å¾—å¾ˆå¤§ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("2. æ— æ³•æ¸…ç†æµ®åŠ¨åƒåœ¾ï¼š")])]),a._v(" "),s("p",[a._v("åœ¨CMSçš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…ç†é˜¶æ®µï¼Œç”¨æˆ·çº¿ç¨‹è¿˜åœ¨ç»§ç»­è¿è¡Œï¼Œå°±è¿˜ä¼šä¼´éšæœ‰æ–°çš„åƒåœ¾å¯¹è±¡ä¸æ–­äº§ç”Ÿï¼Œä½†è¿™ä¸€éƒ¨åˆ†åƒåœ¾å¯¹è±¡æ˜¯å‡ºç°åœ¨æ ‡è®°è¿‡ç¨‹ç»“æŸä»¥åï¼ŒCMSæ— æ³•åœ¨å½“æ¬¡æ”¶é›†ä¸­å¤„ç†æ‰å®ƒä»¬ï¼Œåªå¥½ç•™åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†æ—¶å†æ¸…ç†æ‰ã€‚è¿™ä¸€éƒ¨åˆ†åƒåœ¾ç§°ä¸ºâ€œæµ®åŠ¨åƒåœ¾â€ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("3. å¹¶å‘å¤±è´¥ï¼ˆConcurrent Mode Failureï¼‰ï¼š")])]),a._v(" "),s("p",[a._v("ç”±äºåœ¨åƒåœ¾å›æ”¶é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜åœ¨å¹¶å‘è¿è¡Œï¼Œé‚£å°±è¿˜éœ€è¦é¢„ç•™è¶³å¤Ÿçš„å†…å­˜ç©ºé—´æä¾›ç»™ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨ï¼Œå› æ­¤CMSä¸èƒ½åƒå…¶ä»–å›æ”¶å™¨é‚£æ ·ç­‰åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œå›æ”¶ï¼Œå¿…é¡»é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´ä¾›å¹¶å‘å›æ”¶æ—¶çš„ç¨‹åºè¿è¡Œä½¿ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“è€å¹´ä»£ä½¿ç”¨äº† 92% çš„ç©ºé—´åå°±ä¼šè§¦å‘ CMS åƒåœ¾å›æ”¶ï¼Œè¿™ä¸ªå€¼å¯ä»¥é€šè¿‡ -XX**ğŸ˜—* CMSInitiatingOccupancyFraction å‚æ•°æ¥è®¾ç½®ã€‚")]),a._v(" "),s("p",[a._v("è¿™é‡Œä¼šæœ‰ä¸€ä¸ªé£é™©ï¼šè¦æ˜¯CMSè¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºåˆ†é…æ–°å¯¹è±¡çš„éœ€è¦ï¼Œå°±ä¼šå‡ºç°ä¸€æ¬¡â€œå¹¶å‘å¤±è´¥â€ï¼ˆConcurrent Mode Failureï¼‰ï¼Œè¿™æ—¶å€™è™šæ‹Ÿæœºå°†ä¸å¾—ä¸å¯åŠ¨åå¤‡é¢„æ¡ˆï¼šStop The Worldï¼Œä¸´æ—¶å¯ç”¨ Serial Old æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾å›æ”¶ï¼Œè¿™æ ·ä¸€æ¥åœé¡¿æ—¶é—´å°±å¾ˆé•¿äº†ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("4.å†…å­˜ç¢ç‰‡é—®é¢˜ï¼š")])]),a._v(" "),s("p",[a._v("CMSæ˜¯ä¸€æ¬¾åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„å›æ”¶å™¨ï¼Œè¿™æ„å‘³ç€å›æ”¶ç»“æŸæ—¶ä¼šæœ‰å†…å­˜ç¢ç‰‡äº§ç”Ÿã€‚å†…å­˜ç¢ç‰‡è¿‡å¤šæ—¶ï¼Œå°†ä¼šç»™å¤§å¯¹è±¡åˆ†é…å¸¦æ¥éº»çƒ¦ï¼Œå¾€å¾€ä¼šå‡ºç°è€å¹´ä»£è¿˜æœ‰å¾ˆå¤šå‰©ä½™ç©ºé—´ï¼Œä½†å°±æ˜¯æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œè€Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡ Full GC çš„æƒ…å†µã€‚")]),a._v(" "),s("p",[a._v("ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒCMSæ”¶é›†å™¨æä¾›äº†ä¸€ä¸ª -XX**:"),s("strong",[a._v("+UseCMSCompactAtFullCollection å¼€å…³å‚æ•°ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œç”¨äºåœ¨ Full GC æ—¶å¼€å¯å†…å­˜ç¢ç‰‡çš„åˆå¹¶æ•´ç†è¿‡ç¨‹ï¼Œç”±äºè¿™ä¸ªå†…å­˜æ•´ç†å¿…é¡»ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ˜¯æ— æ³•å¹¶å‘çš„ï¼Œè¿™æ ·åœé¡¿æ—¶é—´å°±ä¼šå˜é•¿ã€‚è¿˜æœ‰å¦å¤–ä¸€ä¸ªå‚æ•° -XX")]),a._v("ğŸ˜—*CMSFullGCsBeforeCompactionï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯è¦æ±‚CMSåœ¨æ‰§è¡Œè¿‡è‹¥å¹²æ¬¡ä¸æ•´ç†ç©ºé—´çš„ Full GC ä¹‹åï¼Œä¸‹ä¸€æ¬¡è¿›å…¥ Full GC å‰ä¼šå…ˆè¿›è¡Œç¢ç‰‡æ•´ç†ï¼ˆé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºæ¯æ¬¡è¿›å…¥ Full GC æ—¶éƒ½è¿›è¡Œç¢ç‰‡æ•´ç†ï¼‰ã€‚")]),a._v(" "),s("h2",{attrs:{id:"_13-è¯¦ç»†è¯´ä¸€ä¸‹g1çš„å›æ”¶è¿‡ç¨‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_13-è¯¦ç»†è¯´ä¸€ä¸‹g1çš„å›æ”¶è¿‡ç¨‹"}},[a._v("#")]),a._v(" 13. è¯¦ç»†è¯´ä¸€ä¸‹G1çš„å›æ”¶è¿‡ç¨‹ï¼Ÿ")]),a._v(" "),s("p",[a._v("G1ï¼ˆGarbage Firstï¼‰å›æ”¶å™¨é‡‡ç”¨é¢å‘å±€éƒ¨æ”¶é›†çš„è®¾è®¡æ€è·¯å’ŒåŸºäºRegionçš„å†…å­˜å¸ƒå±€å½¢å¼ï¼Œæ˜¯ä¸€æ¬¾ä¸»è¦é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾å›æ”¶å™¨ã€‚G1è®¾è®¡åˆè¡·å°±æ˜¯æ›¿æ¢ CMSï¼Œæˆä¸ºä¸€ç§å…¨åŠŸèƒ½æ”¶é›†å™¨ã€‚G1 åœ¨JDK9 ä¹‹åæˆä¸ºæœåŠ¡ç«¯æ¨¡å¼ä¸‹çš„é»˜è®¤åƒåœ¾å›æ”¶å™¨ï¼Œå–ä»£äº† Parallel Scavenge åŠ  Parallel Old çš„é»˜è®¤ç»„åˆï¼Œè€Œ CMS è¢«å£°æ˜ä¸ºä¸æ¨èä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨ã€‚G1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäº æ ‡è®°-æ•´ç† ç®—æ³•å®ç°çš„å›æ”¶å™¨ï¼Œä½†ä»å±€éƒ¨ï¼ˆä¸¤ä¸ªRegionä¹‹é—´ï¼‰ä¸Šçœ‹åˆæ˜¯åŸºäº æ ‡è®°-å¤åˆ¶ ç®—æ³•å®ç°çš„ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("G1 å›æ”¶è¿‡ç¨‹")]),a._v("ï¼ŒG1 å›æ”¶å™¨çš„è¿ä½œè¿‡ç¨‹å¤§è‡´å¯åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("åˆå§‹æ ‡è®°ï¼ˆä¼šSTWï¼‰ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSæŒ‡é’ˆçš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½æ­£ç¡®åœ°åœ¨å¯ç”¨çš„Regionä¸­åˆ†é…æ–°å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ï¼Œè€Œä¸”æ˜¯å€Ÿç”¨è¿›è¡ŒMinor GCçš„æ—¶å€™åŒæ­¥å®Œæˆçš„ï¼Œæ‰€ä»¥G1æ”¶é›†å™¨åœ¨è¿™ä¸ªé˜¶æ®µå®é™…å¹¶æ²¡æœ‰é¢å¤–çš„åœé¡¿ã€‚")])]),a._v(" "),s("li",[s("p",[a._v("å¹¶å‘æ ‡è®°ï¼šä» GC Roots å¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œé€’å½’æ‰«ææ•´ä¸ªå †é‡Œçš„å¯¹è±¡å›¾ï¼Œæ‰¾å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œè¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚å½“å¯¹è±¡å›¾æ‰«æå®Œæˆä»¥åï¼Œè¿˜è¦é‡æ–°å¤„ç†åœ¨å¹¶å‘æ—¶æœ‰å¼•ç”¨å˜åŠ¨çš„å¯¹è±¡ã€‚")])]),a._v(" "),s("li",[s("p",[a._v("æœ€ç»ˆæ ‡è®°ï¼ˆä¼šSTWï¼‰ï¼šå¯¹ç”¨æˆ·çº¿ç¨‹åšçŸ­æš‚çš„æš‚åœï¼Œå¤„ç†å¹¶å‘é˜¶æ®µç»“æŸåä»æœ‰å¼•ç”¨å˜åŠ¨çš„å¯¹è±¡ã€‚")])]),a._v(" "),s("li",[s("p",[a._v("æ¸…ç†é˜¶æ®µï¼ˆä¼šSTWï¼‰ï¼šæ›´æ–°Regionçš„ç»Ÿè®¡æ•°æ®ï¼Œå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œå¯ä»¥è‡ªç”±é€‰æ‹©ä»»æ„å¤šä¸ªRegionæ„æˆå›æ”¶é›†ï¼Œç„¶åæŠŠå†³å®šå›æ”¶çš„é‚£ä¸€éƒ¨åˆ†Regionçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„Regionä¸­ï¼Œå†æ¸…ç†æ‰æ•´ä¸ªæ—§Regionçš„å…¨éƒ¨ç©ºé—´ã€‚è¿™é‡Œçš„æ“ä½œæ¶‰åŠå­˜æ´»å¯¹è±¡çš„ç§»åŠ¨ï¼Œå¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç”±å¤šæ¡å›æ”¶å™¨çº¿ç¨‹å¹¶è¡Œå®Œæˆçš„ã€‚")])])]),a._v(" "),s("h2",{attrs:{id:"_14-jvmä¸­ä¸€æ¬¡å®Œæ•´çš„gcæ˜¯ä»€ä¹ˆæ ·å­çš„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_14-jvmä¸­ä¸€æ¬¡å®Œæ•´çš„gcæ˜¯ä»€ä¹ˆæ ·å­çš„"}},[a._v("#")]),a._v(" 14.  JVMä¸­ä¸€æ¬¡å®Œæ•´çš„GCæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ")]),a._v(" "),s("p",[a._v("å…ˆæè¿°ä¸€ä¸‹Javaå †å†…å­˜åˆ’åˆ†ã€‚")]),a._v(" "),s("p",[a._v("åœ¨ Java ä¸­ï¼Œå †è¢«åˆ’åˆ†æˆä¸¤ä¸ªä¸åŒçš„åŒºåŸŸï¼šæ–°ç”Ÿä»£ ( Young )ã€è€å¹´ä»£ ( Old )ï¼Œæ–°ç”Ÿä»£é»˜è®¤å æ€»ç©ºé—´çš„ 1/3ï¼Œè€å¹´ä»£é»˜è®¤å  2/3ã€‚\næ–°ç”Ÿä»£æœ‰ 3 ä¸ªåˆ†åŒºï¼šEdenã€To Survivorã€From Survivorï¼Œå®ƒä»¬çš„é»˜è®¤å æ¯”æ˜¯ 8:1:1ã€‚")]),a._v(" "),s("p",[a._v("æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼ˆåˆç§°Minor GCï¼‰ååªæœ‰å°‘é‡å¯¹è±¡å­˜æ´»ï¼Œæ‰€ä»¥é€‰ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦å°‘é‡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆå›æ”¶ã€‚")]),a._v(" "),s("p",[a._v("è€å¹´ä»£çš„åƒåœ¾å›æ”¶ï¼ˆåˆç§°Major GCï¼‰é€šå¸¸ä½¿ç”¨â€œæ ‡è®°-æ¸…ç†â€æˆ–â€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210329225348086.png",alt:""}})]),a._v(" "),s("p",[a._v("å†æè¿°å®ƒä»¬ä¹‹é—´è½¬åŒ–æµç¨‹ï¼š")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…ã€‚å½“ eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡ Minor GCã€‚")]),a._v(" "),s("ul",[s("li",[a._v("åœ¨ Eden åŒºæ‰§è¡Œäº†ç¬¬ä¸€æ¬¡ GC ä¹‹åï¼Œå­˜æ´»çš„å¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°å…¶ä¸­ä¸€ä¸ª Survivor åˆ†åŒºï¼›")])]),a._v(" "),s("ul",[s("li",[a._v("Eden åŒºå†æ¬¡ GCï¼Œè¿™æ—¶ä¼šé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œå°† Eden å’Œ from åŒºä¸€èµ·æ¸…ç†ï¼Œå­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ° to åŒºï¼›")]),a._v(" "),s("li",[a._v("ç§»åŠ¨ä¸€æ¬¡ï¼Œå¯¹è±¡å¹´é¾„åŠ  1ï¼Œå¯¹è±¡å¹´é¾„å¤§äºä¸€å®šé˜€å€¼ä¼šç›´æ¥ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚GCå¹´é¾„çš„é˜€å€¼å¯ä»¥é€šè¿‡å‚æ•° -XX:MaxTenuringThreshold è®¾ç½®ï¼Œé»˜è®¤ä¸º 15ï¼›")]),a._v(" "),s("li",[a._v("åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®šï¼šSurvivor åŒºç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œ > (Survivor åŒºå†…å­˜å¤§å° * è¿™ä¸ªç›®æ ‡ä½¿ç”¨ç‡)æ—¶ï¼Œå¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚å…¶ä¸­è¿™ä¸ªä½¿ç”¨ç‡é€šè¿‡ -XX:TargetSurvivorRatio æŒ‡å®šï¼Œé»˜è®¤ä¸º 50%ï¼›")]),a._v(" "),s("li",[a._v("Survivor åŒºå†…å­˜ä¸è¶³ä¼šå‘ç”Ÿæ‹…ä¿åˆ†é…ï¼Œè¶…è¿‡æŒ‡å®šå¤§å°çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚")])])]),a._v(" "),s("li",[s("p",[a._v("å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œå¤§å¯¹è±¡å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ï¼Œä¸ºäº†é¿å…ä¸ºå¤§å¯¹è±¡åˆ†é…å†…å­˜æ—¶ç”±äºåˆ†é…æ‹…ä¿æœºåˆ¶å¸¦æ¥çš„å¤åˆ¶è€Œé™ä½æ•ˆç‡ã€‚")])]),a._v(" "),s("li",[s("p",[a._v("è€å¹´ä»£æ»¡äº†è€Œ"),s("strong",[a._v("æ— æ³•å®¹çº³æ›´å¤šçš„å¯¹è±¡")]),a._v("ï¼ŒMinor GC ä¹‹åé€šå¸¸å°±ä¼šè¿›è¡ŒFull GCï¼ŒFull GC æ¸…ç†æ•´ä¸ªå†…å­˜å † â€“ "),s("strong",[a._v("åŒ…æ‹¬å¹´è½»ä»£å’Œè€å¹´ä»£")]),a._v("ã€‚")])])]),a._v(" "),s("h2",{attrs:{id:"_15-minor-gc-å’Œ-full-gc-æœ‰ä»€ä¹ˆä¸åŒå‘¢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_15-minor-gc-å’Œ-full-gc-æœ‰ä»€ä¹ˆä¸åŒå‘¢"}},[a._v("#")]),a._v(" 15. Minor GC å’Œ Full GC æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ")]),a._v(" "),s("p",[a._v("Minor GCï¼šåªæ”¶é›†æ–°ç”Ÿä»£çš„GCã€‚")]),a._v(" "),s("p",[a._v("Full GC: æ”¶é›†æ•´ä¸ªå †ï¼ŒåŒ…æ‹¬ æ–°ç”Ÿä»£ï¼Œè€å¹´ä»£ï¼Œæ°¸ä¹…ä»£(åœ¨ JDK 1.8åŠä»¥åï¼Œæ°¸ä¹…ä»£è¢«ç§»é™¤ï¼Œæ¢ä¸ºmetaspace å…ƒç©ºé—´)ç­‰æ‰€æœ‰éƒ¨åˆ†çš„æ¨¡å¼ã€‚")]),a._v(" "),s("p",[a._v("**Minor GCè§¦å‘æ¡ä»¶ï¼š**å½“EdenåŒºæ»¡æ—¶ï¼Œè§¦å‘Minor GCã€‚")]),a._v(" "),s("p",[s("strong",[a._v("Full GCè§¦å‘æ¡ä»¶")]),a._v("ï¼š")]),a._v(" "),s("ul",[s("li",[a._v("é€šè¿‡Minor GCåè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜ã€‚å¦‚æœå‘ç°ç»Ÿè®¡æ•°æ®è¯´ä¹‹å‰Minor GCçš„å¹³å‡æ™‹å‡å¤§å°æ¯”ç›®å‰old genå‰©ä½™çš„ç©ºé—´å¤§ï¼Œåˆ™ä¸ä¼šè§¦å‘Minor GCè€Œæ˜¯è½¬ä¸ºè§¦å‘full GCã€‚")]),a._v(" "),s("li",[a._v("è€å¹´ä»£ç©ºé—´ä¸å¤Ÿåˆ†é…æ–°çš„å†…å­˜ï¼ˆæˆ–æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³ï¼Œä½†åªæ˜¯JDK1.7æœ‰çš„ï¼Œè¿™ä¹Ÿæ˜¯ç”¨å…ƒç©ºé—´æ¥å–ä»£æ°¸ä¹…ä»£çš„åŸå› ï¼Œå¯ä»¥å‡å°‘Full GCçš„é¢‘ç‡ï¼Œå‡å°‘GCè´Ÿæ‹…ï¼Œæå‡å…¶æ•ˆç‡ï¼‰ã€‚")]),a._v(" "),s("li",[a._v("ç”±EdenåŒºã€From SpaceåŒºå‘To SpaceåŒºå¤åˆ¶æ—¶ï¼Œå¯¹è±¡å¤§å°å¤§äºTo Spaceå¯ç”¨å†…å­˜ï¼Œåˆ™æŠŠè¯¥å¯¹è±¡è½¬å­˜åˆ°è€å¹´ä»£ï¼Œä¸”è€å¹´ä»£çš„å¯ç”¨å†…å­˜å°äºè¯¥å¯¹è±¡å¤§å°ã€‚")]),a._v(" "),s("li",[a._v("è°ƒç”¨System.gcæ—¶ï¼Œç³»ç»Ÿå»ºè®®æ‰§è¡ŒFull GCï¼Œä½†æ˜¯ä¸å¿…ç„¶æ‰§è¡Œã€‚")])]),a._v(" "),s("h2",{attrs:{id:"_16-ä»‹ç»ä¸‹ç©ºé—´åˆ†é…æ‹…ä¿åŸåˆ™"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_16-ä»‹ç»ä¸‹ç©ºé—´åˆ†é…æ‹…ä¿åŸåˆ™"}},[a._v("#")]),a._v(" 16. ä»‹ç»ä¸‹ç©ºé—´åˆ†é…æ‹…ä¿åŸåˆ™ï¼Ÿ")]),a._v(" "),s("p",[a._v("å¦‚æœYougGCæ—¶æ–°ç”Ÿä»£æœ‰å¤§é‡å¯¹è±¡å­˜æ´»ä¸‹æ¥ï¼Œè€Œ survivor åŒºæ”¾ä¸ä¸‹äº†ï¼Œè¿™æ—¶å¿…é¡»è½¬ç§»åˆ°è€å¹´ä»£ä¸­ï¼Œä½†è¿™æ—¶å‘ç°è€å¹´ä»£ä¹Ÿæ”¾ä¸ä¸‹è¿™äº›å¯¹è±¡äº†ï¼Œé‚£æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿå…¶å®JVMæœ‰ä¸€ä¸ªè€å¹´ä»£ç©ºé—´åˆ†é…æ‹…ä¿æœºåˆ¶æ¥ä¿è¯å¯¹è±¡èƒ½å¤Ÿè¿›å…¥è€å¹´ä»£ã€‚")]),a._v(" "),s("p",[a._v("åœ¨æ‰§è¡Œæ¯æ¬¡ YoungGC ä¹‹å‰ï¼ŒJVMä¼šå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»å¤§å°ã€‚å› ä¸ºåœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¯èƒ½æ–°ç”Ÿä»£ YoungGC åï¼Œæ‰€æœ‰å¯¹è±¡éƒ½å­˜æ´»ä¸‹æ¥äº†ï¼Œè€Œ survivor åŒºåˆæ”¾ä¸ä¸‹ï¼Œé‚£å¯èƒ½æ‰€æœ‰å¯¹è±¡éƒ½è¦è¿›å…¥è€å¹´ä»£äº†ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœè€å¹´ä»£çš„å¯ç”¨è¿ç»­ç©ºé—´æ˜¯å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»å¤§å°çš„ï¼Œé‚£å°±å¯ä»¥æ”¾å¿ƒè¿›è¡Œ YoungGCã€‚ä½†å¦‚æœè€å¹´ä»£çš„å†…å­˜å¤§å°æ˜¯å°äºæ–°ç”Ÿä»£å¯¹è±¡æ€»å¤§å°çš„ï¼Œé‚£å°±æœ‰å¯èƒ½è€å¹´ä»£ç©ºé—´ä¸å¤Ÿæ”¾å…¥æ–°ç”Ÿä»£æ‰€æœ‰å­˜æ´»å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™JVMå°±ä¼šå…ˆæ£€æŸ¥ -XX:HandlePromotionFailure å‚æ•°æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå¦‚æœå…è®¸ï¼Œå°±ä¼šåˆ¤æ–­è€å¹´ä»£æœ€å¤§å¯ç”¨è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•è¿›è¡Œä¸€æ¬¡YoungGCï¼Œå°½å¿«è¿™æ¬¡YoungGCæ˜¯æœ‰é£é™©çš„ã€‚å¦‚æœå°äºï¼Œæˆ–è€… -XX:HandlePromotionFailure å‚æ•°ä¸å…è®¸æ‹…ä¿å¤±è´¥ï¼Œè¿™æ—¶å°±ä¼šè¿›è¡Œä¸€æ¬¡ Full GCã€‚")]),a._v(" "),s("p",[a._v("åœ¨å…è®¸æ‹…ä¿å¤±è´¥å¹¶å°è¯•è¿›è¡ŒYoungGCåï¼Œå¯èƒ½ä¼šå‡ºç°ä¸‰ç§æƒ…å†µï¼š")]),a._v(" "),s("ul",[s("li",[a._v("â‘  YoungGCåï¼Œå­˜æ´»å¯¹è±¡å°äºsurvivorå¤§å°ï¼Œæ­¤æ—¶å­˜æ´»å¯¹è±¡è¿›å…¥survivoråŒºä¸­")]),a._v(" "),s("li",[a._v("â‘¡ YoungGCåï¼Œå­˜æ´»å¯¹è±¡å¤§äºsurvivorå¤§å°ï¼Œä½†æ˜¯å°äºè€å¹´å¤§å¯ç”¨ç©ºé—´å¤§å°ï¼Œæ­¤æ—¶ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚")]),a._v(" "),s("li",[a._v("â‘¢ YoungGCåï¼Œå­˜æ´»å¯¹è±¡å¤§äºsurvivorå¤§å°ï¼Œä¹Ÿå¤§äºè€å¹´å¤§å¯ç”¨ç©ºé—´å¤§å°ï¼Œè€å¹´ä»£ä¹Ÿæ”¾ä¸ä¸‹è¿™äº›å¯¹è±¡äº†ï¼Œæ­¤æ—¶å°±ä¼šå‘ç”Ÿâ€œHandle Promotion Failureâ€ï¼Œå°±è§¦å‘äº† Full GCã€‚å¦‚æœ Full GCåï¼Œè€å¹´ä»£è¿˜æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œæ­¤æ—¶å°±ä¼šå‘ç”ŸOOMå†…å­˜æº¢å‡ºäº†ã€‚")])]),a._v(" "),s("p",[a._v("é€šè¿‡ä¸‹å›¾æ¥äº†è§£ç©ºé—´åˆ†é…æ‹…ä¿åŸåˆ™ï¼š")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210329230240201.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"_17-ä»€ä¹ˆæ˜¯ç±»åŠ è½½-ç±»åŠ è½½çš„è¿‡ç¨‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_17-ä»€ä¹ˆæ˜¯ç±»åŠ è½½-ç±»åŠ è½½çš„è¿‡ç¨‹"}},[a._v("#")]),a._v(" 17. ä»€ä¹ˆæ˜¯ç±»åŠ è½½ï¼Ÿç±»åŠ è½½çš„è¿‡ç¨‹ï¼Ÿ")]),a._v(" "),s("p",[a._v("è™šæ‹ŸæœºæŠŠæè¿°ç±»çš„æ•°æ®åŠ è½½åˆ°å†…å­˜é‡Œé¢ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è§£æå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆå˜æˆå¯ä»¥è¢«è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨çš„classå¯¹è±¡ï¼›")]),a._v(" "),s("p",[a._v("ç±»çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼šåŠ è½½ï¼ˆLoadingï¼‰ã€éªŒè¯ï¼ˆVerificationï¼‰ã€å‡†å¤‡(Preparation)ã€è§£æ(Resolution)ã€åˆå§‹åŒ–(Initialization)ã€ä½¿ç”¨(Using)å’Œå¸è½½(Unloading)7ä¸ªé˜¶æ®µã€‚å…¶ä¸­å‡†å¤‡ã€éªŒè¯ã€è§£æ3ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆLinkingï¼‰ã€‚å¦‚å›¾æ‰€ç¤ºï¼š")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210329231258940.png",alt:"image-20210329231258940"}})]),a._v(" "),s("p",[a._v("åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–å’Œå¸è½½è¿™5ä¸ªé˜¶æ®µçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹å¿…é¡»æŒ‰ç…§è¿™ç§é¡ºåºæŒ‰éƒ¨å°±ç­åœ°å¼€å§‹ï¼Œè€Œè§£æé˜¶æ®µåˆ™ä¸ä¸€å®šï¼šå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå†å¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒJavaè¯­è¨€çš„è¿è¡Œæ—¶ç»‘å®šï¼ˆä¹Ÿç§°ä¸ºåŠ¨æ€ç»‘å®šæˆ–æ™šæœŸç»‘å®šï¼‰")]),a._v(" "),s("p",[a._v("ç±»åŠ è½½è¿‡ç¨‹å¦‚ä¸‹ï¼š")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("åŠ è½½ï¼ŒåŠ è½½åˆ†ä¸ºä¸‰æ­¥ï¼š\n1ã€é€šè¿‡ç±»çš„å…¨é™å®šæ€§ç±»åè·å–è¯¥ç±»çš„äºŒè¿›åˆ¶æµï¼›\n2ã€å°†è¯¥äºŒè¿›åˆ¶æµçš„é™æ€å­˜å‚¨ç»“æ„è½¬ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼›\n3ã€åœ¨å †ä¸­ä¸ºè¯¥ç±»ç”Ÿæˆä¸€ä¸ªclasså¯¹è±¡ï¼›")])]),a._v(" "),s("li",[s("p",[a._v("éªŒè¯ï¼šéªŒè¯è¯¥classæ–‡ä»¶ä¸­çš„å­—èŠ‚æµä¿¡æ¯å¤åˆè™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œä¸ä¼šå¨èƒåˆ°jvmçš„å®‰å…¨ï¼›")])]),a._v(" "),s("li",[s("p",[a._v("å‡†å¤‡ï¼šä¸ºclasså¯¹è±¡çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œåˆå§‹åŒ–å…¶åˆå§‹å€¼ï¼›")])]),a._v(" "),s("li",[s("p",[a._v("è§£æï¼šè¯¥é˜¶æ®µä¸»è¦å®Œæˆç¬¦å·å¼•ç”¨è½¬åŒ–æˆç›´æ¥å¼•ç”¨ï¼›")])]),a._v(" "),s("li",[s("p",[a._v("åˆå§‹åŒ–ï¼šåˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œæ‰å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„javaä»£ç ï¼›åˆå§‹åŒ–é˜¶æ®µæ˜¯è°ƒç”¨ç±»æ„é€ å™¨çš„è¿‡ç¨‹ï¼›")])])]),a._v(" "),s("h2",{attrs:{id:"_18-ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨-å¸¸è§çš„ç±»åŠ è½½å™¨æœ‰å“ªäº›"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_18-ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨-å¸¸è§çš„ç±»åŠ è½½å™¨æœ‰å“ªäº›"}},[a._v("#")]),a._v(" 18. ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œå¸¸è§çš„ç±»åŠ è½½å™¨æœ‰å“ªäº›ï¼Ÿ")]),a._v(" "),s("p",[a._v("ç±»åŠ è½½å™¨æ˜¯æŒ‡ï¼šé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šæ€§ç±»åè·å–è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµå«åšç±»åŠ è½½å™¨ï¼›ç±»åŠ è½½å™¨åˆ†ä¸ºä»¥ä¸‹å››ç§ï¼š")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootStrapClassLoaderï¼‰ï¼šç”¨æ¥åŠ è½½javaæ ¸å¿ƒç±»åº“ï¼Œæ— æ³•è¢«javaç¨‹åºç›´æ¥å¼•ç”¨ï¼›")])]),a._v(" "),s("li",[s("p",[a._v("æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼šç”¨æ¥åŠ è½½javaçš„æ‰©å±•åº“ï¼Œjavaçš„è™šæ‹Ÿæœºå®ç°ä¼šæä¾›ä¸€ä¸ªæ‰©å±•åº“ç›®å½•ï¼Œè¯¥ç±»åŠ è½½å™¨åœ¨æ‰©å±•åº“ç›®å½•é‡Œé¢æŸ¥æ‰¾å¹¶åŠ è½½javaç±»ï¼›")])]),a._v(" "),s("li",[s("p",[a._v("ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆAppClassLoaderï¼‰ï¼šå®ƒæ ¹æ®javaçš„ç±»è·¯å¾„æ¥åŠ è½½ç±»ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œjavaåº”ç”¨çš„ç±»éƒ½æ˜¯é€šè¿‡å®ƒæ¥åŠ è½½çš„ï¼›")])]),a._v(" "),s("li",[s("p",[a._v("è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼šç”±javaè¯­è¨€å®ç°ï¼Œç»§æ‰¿è‡ªClassLoaderï¼›")])])]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210329231439914.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"_19-ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹-ä¸ºä»€ä¹ˆéœ€è¦åŒäº²å§”æ´¾æ¨¡å‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_19-ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹-ä¸ºä»€ä¹ˆéœ€è¦åŒäº²å§”æ´¾æ¨¡å‹"}},[a._v("#")]),a._v(" 19. ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ")]),a._v(" "),s("p",[a._v("å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°ä¸€ä¸ªç±»åŠ è½½çš„è¯·æ±‚ï¼Œä»–é¦–å…ˆä¸ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè€Œæ˜¯å°†è¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½ï¼Œåªæœ‰çˆ¶ç±»åŠ è½½å™¨åœ¨è‡ªå·±çš„æœç´¢èŒƒå›´ç±»æŸ¥æ‰¾ä¸åˆ°ç»™ç±»æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½è¯¥ç±»ï¼›")]),a._v(" "),s("p",[a._v("ä¸ºäº†é˜²æ­¢å†…å­˜ä¸­å‡ºç°å¤šä¸ªç›¸åŒçš„å­—èŠ‚ç ï¼›å› ä¸ºå¦‚æœæ²¡æœ‰åŒäº²å§”æ´¾çš„è¯ï¼Œç”¨æˆ·å°±å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªjava.lang.Stringç±»ï¼Œé‚£ä¹ˆå°±æ— æ³•ä¿è¯ç±»çš„å”¯ä¸€æ€§ã€‚")]),a._v(" "),s("p",[a._v("è¡¥å……ï¼š"),s("strong",[a._v("é‚£æ€ä¹ˆæ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹")]),a._v("ï¼Ÿ")]),a._v(" "),s("p",[a._v("è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œç»§æ‰¿ClassLoaderç±»ï¼Œé‡å†™loadClassæ–¹æ³•å’ŒfindClassæ–¹æ³•ã€‚")]),a._v(" "),s("h2",{attrs:{id:"_20-åˆ—ä¸¾ä¸€äº›ä½ çŸ¥é“çš„æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„ä¾‹å­-ä¸ºä»€ä¹ˆè¦æ‰“ç ´"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_20-åˆ—ä¸¾ä¸€äº›ä½ çŸ¥é“çš„æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„ä¾‹å­-ä¸ºä»€ä¹ˆè¦æ‰“ç ´"}},[a._v("#")]),a._v(" 20. åˆ—ä¸¾ä¸€äº›ä½ çŸ¥é“çš„æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„ä¾‹å­ï¼Œä¸ºä»€ä¹ˆè¦æ‰“ç ´ï¼Ÿ")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("JNDI é€šè¿‡å¼•å…¥çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œå¯ä»¥åœ¨ Thread.setContextClassLoader æ–¹æ³•è®¾ç½®ï¼Œé»˜è®¤æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œæ¥åŠ è½½ SPI çš„ä»£ç ã€‚æœ‰äº†çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œå°±å¯ä»¥å®Œæˆçˆ¶ç±»åŠ è½½å™¨è¯·æ±‚å­ç±»åŠ è½½å™¨å®Œæˆç±»åŠ è½½çš„è¡Œä¸ºã€‚æ‰“ç ´çš„åŸå› ï¼Œæ˜¯ä¸ºäº† JNDI æœåŠ¡çš„ç±»åŠ è½½å™¨æ˜¯å¯åŠ¨å™¨ç±»åŠ è½½ï¼Œä¸ºäº†å®Œæˆé«˜çº§ç±»åŠ è½½å™¨è¯·æ±‚å­ç±»åŠ è½½å™¨ï¼ˆå³ä¸Šæ–‡ä¸­çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼‰åŠ è½½ç±»ã€‚")])]),a._v(" "),s("li",[s("p",[a._v("Tomcatï¼Œåº”ç”¨çš„ç±»åŠ è½½å™¨ä¼˜å…ˆè‡ªè¡ŒåŠ è½½åº”ç”¨ç›®å½•ä¸‹çš„ classï¼Œå¹¶ä¸æ˜¯å…ˆå§”æ´¾ç»™çˆ¶åŠ è½½å™¨ï¼ŒåŠ è½½ä¸äº†æ‰å§”æ´¾ç»™çˆ¶åŠ è½½å™¨ã€‚")]),a._v(" "),s("p",[a._v("tomcatä¹‹æ‰€ä»¥é€ äº†ä¸€å †è‡ªå·±çš„classloaderï¼Œå¤§è‡´æ˜¯å‡ºäºä¸‹é¢ä¸‰ç±»ç›®çš„ï¼š")]),a._v(" "),s("ul",[s("li",[a._v("å¯¹äºå„ä¸ª "),s("code",[a._v("webapp")]),a._v("ä¸­çš„ "),s("code",[a._v("class")]),a._v("å’Œ "),s("code",[a._v("lib")]),a._v("ï¼Œéœ€è¦ç›¸äº’éš”ç¦»ï¼Œä¸èƒ½å‡ºç°ä¸€ä¸ªåº”ç”¨ä¸­åŠ è½½çš„ç±»åº“ä¼šå½±å“å¦ä¸€ä¸ªåº”ç”¨çš„æƒ…å†µï¼Œè€Œå¯¹äºè®¸å¤šåº”ç”¨ï¼Œéœ€è¦æœ‰å…±äº«çš„libä»¥ä¾¿ä¸æµªè´¹èµ„æºã€‚")]),a._v(" "),s("li",[a._v("ä¸ "),s("code",[a._v("jvm")]),a._v("ä¸€æ ·çš„å®‰å…¨æ€§é—®é¢˜ã€‚ä½¿ç”¨å•ç‹¬çš„ "),s("code",[a._v("classloader")]),a._v("å»è£…è½½ "),s("code",[a._v("tomcat")]),a._v("è‡ªèº«çš„ç±»åº“ï¼Œä»¥å…å…¶ä»–æ¶æ„æˆ–æ— æ„çš„ç ´åï¼›")]),a._v(" "),s("li",[a._v("çƒ­éƒ¨ç½²ã€‚")])]),a._v(" "),s("p",[a._v("tomcatç±»åŠ è½½å™¨å¦‚ä¸‹å›¾ï¼š")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://blog-img.coolsen.cn/img/image-20210329231930719.png",alt:""}})])]),a._v(" "),s("li",[s("p",[a._v("OSGiï¼Œå®ç°æ¨¡å—åŒ–çƒ­éƒ¨ç½²ï¼Œä¸ºæ¯ä¸ªæ¨¡å—éƒ½è‡ªå®šä¹‰äº†ç±»åŠ è½½å™¨ï¼Œéœ€è¦æ›´æ¢æ¨¡å—æ—¶ï¼Œæ¨¡å—ä¸ç±»åŠ è½½å™¨ä¸€èµ·æ›´æ¢ã€‚å…¶ç±»åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¹³çº§çš„ç±»åŠ è½½å™¨åŠ è½½è¡Œä¸ºã€‚æ‰“ç ´çš„åŸå› æ˜¯ä¸ºäº†å®ç°æ¨¡å—çƒ­æ›¿æ¢ã€‚")])]),a._v(" "),s("li",[s("p",[a._v("JDK 9ï¼ŒExtension ClassLoader è¢« Platform ClassLoader å–ä»£ï¼Œå½“å¹³å°åŠåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚ï¼Œåœ¨å§”æ´¾ç»™çˆ¶åŠ è½½å™¨åŠ è½½å‰ï¼Œè¦å…ˆåˆ¤æ–­è¯¥ç±»æ˜¯å¦èƒ½å¤Ÿå½’å±åˆ°æŸä¸€ä¸ªç³»ç»Ÿæ¨¡å—ä¸­ï¼Œå¦‚æœå¯ä»¥æ‰¾åˆ°è¿™æ ·çš„å½’å±å…³ç³»ï¼Œå°±è¦ä¼˜å…ˆå§”æ´¾ç»™è´Ÿè´£é‚£ä¸ªæ¨¡å—çš„åŠ è½½å™¨å®ŒæˆåŠ è½½ã€‚æ‰“ç ´çš„åŸå› ï¼Œæ˜¯ä¸ºäº†æ·»åŠ æ¨¡å—åŒ–çš„ç‰¹æ€§ã€‚")])])]),a._v(" "),s("h2",{attrs:{id:"_21-è¯´ä¸€ä¸‹-jvm-è°ƒä¼˜çš„å‘½ä»¤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_21-è¯´ä¸€ä¸‹-jvm-è°ƒä¼˜çš„å‘½ä»¤"}},[a._v("#")]),a._v(" 21. è¯´ä¸€ä¸‹ JVM è°ƒä¼˜çš„å‘½ä»¤ï¼Ÿ")]),a._v(" "),s("ul",[s("li",[a._v("jpsï¼šJVM Process Status Tool,æ˜¾ç¤ºæŒ‡å®šç³»ç»Ÿå†…æ‰€æœ‰çš„HotSpotè™šæ‹Ÿæœºè¿›ç¨‹ã€‚")]),a._v(" "),s("li",[a._v("jstatï¼šjstat(JVM statistics Monitoring)æ˜¯ç”¨äºç›‘è§†è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚")]),a._v(" "),s("li",[a._v("jmapï¼šjmap(JVM Memory Map)å‘½ä»¤ç”¨äºç”Ÿæˆheap dumpæ–‡ä»¶ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œè¿˜é˜”ä»¥ä½¿ç”¨-XX:+HeapDumpOnOutOfMemoryErrorå‚æ•°æ¥è®©è™šæ‹Ÿæœºå‡ºç°OOMçš„æ—¶å€™Â·è‡ªåŠ¨ç”Ÿæˆdumpæ–‡ä»¶ã€‚\njmapä¸ä»…èƒ½ç”Ÿæˆdumpæ–‡ä»¶ï¼Œè¿˜é˜”ä»¥æŸ¥è¯¢finalizeæ‰§è¡Œé˜Ÿåˆ—ã€Javaå †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚å½“å‰ä½¿ç”¨ç‡ã€å½“å‰ä½¿ç”¨çš„æ˜¯å“ªç§æ”¶é›†å™¨ç­‰ã€‚")]),a._v(" "),s("li",[a._v("jhatï¼šjhat(JVM Heap Analysis Tool)å‘½ä»¤æ˜¯ä¸jmapæ­é…ä½¿ç”¨ï¼Œç”¨æ¥åˆ†æjmapç”Ÿæˆçš„dumpï¼Œjhatå†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„HTTP/HTMLæœåŠ¡å™¨ï¼Œç”Ÿæˆdumpçš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚åœ¨æ­¤è¦æ³¨æ„ï¼Œä¸€èˆ¬ä¸ä¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œåˆ†æï¼Œå› ä¸ºjhatæ˜¯ä¸€ä¸ªè€—æ—¶å¹¶ä¸”è€—è´¹ç¡¬ä»¶èµ„æºçš„è¿‡ç¨‹ï¼Œä¸€èˆ¬æŠŠæœåŠ¡å™¨ç”Ÿæˆçš„dumpæ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°æˆ–å…¶ä»–æœºå™¨ä¸Šè¿›è¡Œåˆ†æã€‚")]),a._v(" "),s("li",[a._v("jstackï¼šjstackç”¨äºç”Ÿæˆjavaè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ä»€ä¹ˆèµ„æºã€‚ å¦‚æœjavaç¨‹åºå´©æºƒç”Ÿæˆcoreæ–‡ä»¶ï¼Œjstackå·¥å…·å¯ä»¥ç”¨æ¥è·å¾—coreæ–‡ä»¶çš„java stackå’Œnative stackçš„ä¿¡æ¯ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°çŸ¥é“javaç¨‹åºæ˜¯å¦‚ä½•å´©æºƒå’Œåœ¨ç¨‹åºä½•å¤„å‘ç”Ÿé—®é¢˜ã€‚")])]),a._v(" "),s("h2",{attrs:{id:"_22-javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_22-javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹"}},[a._v("#")]),a._v(" 22. Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹")]),a._v(" "),s("ol",[s("li",[a._v("JVMé‡åˆ°ä¸€æ¡æ–°å»ºå¯¹è±¡çš„æŒ‡ä»¤æ—¶é¦–å…ˆå»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä¹‰åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ã€‚ç„¶ååŠ è½½è¿™ä¸ªç±»ï¼ˆç±»åŠ è½½è¿‡ç¨‹åœ¨åè¾¹è®²ï¼‰")]),a._v(" "),s("li",[a._v("ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚ä¸€ç§åŠæ³•â€œæŒ‡é’ˆç¢°æ’â€ã€ä¸€ç§åŠæ³•â€œç©ºé—²åˆ—è¡¨â€ï¼Œæœ€ç»ˆå¸¸ç”¨çš„åŠæ³•â€œæœ¬åœ°çº¿ç¨‹ç¼“å†²åˆ†é…(TLAB)â€")]),a._v(" "),s("li",[a._v("å°†é™¤å¯¹è±¡å¤´å¤–çš„å¯¹è±¡å†…å­˜ç©ºé—´åˆå§‹åŒ–ä¸º0")]),a._v(" "),s("li",[a._v("å¯¹å¯¹è±¡å¤´è¿›è¡Œå¿…è¦è®¾ç½®")])]),a._v(" "),s("h2",{attrs:{id:"_23-jdkæ–°ç‰¹æ€§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_23-jdkæ–°ç‰¹æ€§"}},[a._v("#")]),a._v(" 23. JDKæ–°ç‰¹æ€§")]),a._v(" "),s("p",[s("strong",[a._v("JDK8")])]),a._v(" "),s("p",[a._v("æ”¯æŒ Lamda è¡¨è¾¾å¼ã€é›†åˆçš„ stream æ“ä½œã€æå‡HashMapæ€§èƒ½")]),a._v(" "),s("p",[s("strong",[a._v("JDK9")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//Stream APIä¸­iterateæ–¹æ³•çš„æ–°é‡è½½æ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®šä»€ä¹ˆæ—¶å€™ç»“æŸè¿­ä»£")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("IntStream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("iterate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),a._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),a._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("é»˜è®¤G1åƒåœ¾å›æ”¶å™¨")]),a._v(" "),s("p",[s("strong",[a._v("JDK10")])]),a._v(" "),s("p",[a._v("å…¶é‡ç‚¹åœ¨äºé€šè¿‡å®Œå…¨GCå¹¶è¡Œæ¥æ”¹å–„G1æœ€åæƒ…å†µçš„ç­‰å¾…æ—¶é—´ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("JDK11")])]),a._v(" "),s("p",[a._v("ZGC (å¹¶å‘å›æ”¶çš„ç­–ç•¥) 4TB")]),a._v(" "),s("p",[a._v("ç”¨äº Lambda å‚æ•°çš„å±€éƒ¨å˜é‡è¯­æ³•")]),a._v(" "),s("p",[s("strong",[a._v("JDK12")])]),a._v(" "),s("p",[a._v("Shenandoah GC (GC ç®—æ³•)åœé¡¿æ—¶é—´å’Œå †çš„å¤§å°æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œå¹¶è¡Œå…³æ³¨åœé¡¿å“åº”æ—¶é—´ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("JDK13")])]),a._v(" "),s("p",[a._v("å¢åŠ ZGCä»¥å°†æœªä½¿ç”¨çš„å †å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿï¼Œ16TB")]),a._v(" "),s("p",[s("strong",[a._v("JDK14")])]),a._v(" "),s("p",[a._v("åˆ é™¤cmsåƒåœ¾å›æ”¶å™¨ã€å¼ƒç”¨ParallelScavenge+SerialOldGCåƒåœ¾å›æ”¶ç®—æ³•ç»„åˆ")]),a._v(" "),s("p",[a._v("å°†ZGCåƒåœ¾å›æ”¶å™¨åº”ç”¨åˆ°macOSå’Œwindowså¹³å°")]),a._v(" "),s("h1",{attrs:{id:"çº¿ä¸Šæ•…éšœæ’æŸ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#çº¿ä¸Šæ•…éšœæ’æŸ¥"}},[a._v("#")]),a._v(" çº¿ä¸Šæ•…éšœæ’æŸ¥")]),a._v(" "),s("h2",{attrs:{id:"_1ã€ç¡¬ä»¶æ•…éšœæ’æŸ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1ã€ç¡¬ä»¶æ•…éšœæ’æŸ¥"}},[a._v("#")]),a._v(" 1ã€ç¡¬ä»¶æ•…éšœæ’æŸ¥")]),a._v(" "),s("p",[a._v("å¦‚æœä¸€ä¸ªå®ä¾‹å‘ç”Ÿäº†é—®é¢˜ï¼Œæ ¹æ®æƒ…å†µé€‰æ‹©ï¼Œè¦ä¸è¦ç€æ€¥å»é‡å¯ã€‚å¦‚æœå‡ºç°çš„CPUã€å†…å­˜é£™é«˜æˆ–è€…æ—¥å¿—é‡Œå‡ºç°äº†OOMå¼‚å¸¸")]),a._v(" "),s("p",[s("strong",[a._v("ç¬¬ä¸€æ­¥æ˜¯éš”ç¦»")]),a._v("ï¼Œç¬¬äºŒæ­¥æ˜¯"),s("strong",[a._v("ä¿ç•™ç°åœº")]),a._v("ï¼Œç¬¬ä¸‰æ­¥æ‰æ˜¯"),s("strong",[a._v("é—®é¢˜æ’æŸ¥")]),a._v("ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("éš”ç¦»")])]),a._v(" "),s("p",[a._v("å°±æ˜¯æŠŠä½ çš„è¿™å°æœºå™¨ä»è¯·æ±‚åˆ—è¡¨é‡Œæ‘˜é™¤ï¼Œæ¯”å¦‚æŠŠ nginx ç›¸å…³çš„æƒé‡è®¾æˆé›¶ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("ç°åœºä¿ç•™")])]),a._v(" "),s("p",[s("strong",[a._v("ç¬æ—¶æ€å’Œå†å²æ€")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEly1gobnwy22d2j30l10cpt9d.jpg",alt:"img"}})]),a._v(" "),s("p",[a._v("æŸ¥çœ‹æ¯”å¦‚ CPUã€ç³»ç»Ÿå†…å­˜ç­‰ï¼Œé€šè¿‡å†å²çŠ¶æ€å¯ä»¥ä½“ç°ä¸€ä¸ªè¶‹åŠ¿æ€§é—®é¢˜ï¼Œè€Œè¿™äº›ä¿¡æ¯çš„è·å–ä¸€èˆ¬ä¾é ç›‘æ§ç³»ç»Ÿçš„åä½œã€‚")]),a._v(" "),s("p",[s("strong",[a._v("ä¿ç•™ä¿¡æ¯")])]),a._v(" "),s("p",[a._v("ï¼ˆ1ï¼‰"),s("strong",[a._v("ç³»ç»Ÿå½“å‰ç½‘ç»œè¿æ¥")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ss -antp > $DUMP_DIR/ss.dump 2>&1\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("ä½¿ç”¨ ss å‘½ä»¤è€Œä¸æ˜¯ netstat çš„åŸå› ï¼Œæ˜¯å› ä¸º netstat åœ¨ç½‘ç»œè¿æ¥éå¸¸å¤šçš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œéå¸¸ç¼“æ…¢ã€‚")]),a._v(" "),s("p",[a._v("åç»­çš„å¤„ç†ï¼Œå¯é€šè¿‡æŸ¥çœ‹å„ç§ç½‘ç»œè¿æ¥çŠ¶æ€çš„æ¢³ç†ï¼Œæ¥æ’æŸ¥ TIME_WAIT æˆ–è€… CLOSE_WAITï¼Œæˆ–è€…å…¶ä»–è¿æ¥è¿‡é«˜çš„é—®é¢˜ï¼Œéå¸¸æœ‰ç”¨ã€‚")]),a._v(" "),s("p",[a._v("ï¼ˆ2ï¼‰"),s("strong",[a._v("ç½‘ç»œçŠ¶æ€ç»Ÿè®¡")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("netstat "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("netstat"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("å®ƒèƒ½å¤ŸæŒ‰ç…§å„ä¸ªåè®®è¿›è¡Œç»Ÿè®¡è¾“å‡ºï¼Œå¯¹æŠŠæ¡å½“æ—¶æ•´ä¸ªç½‘ç»œçŠ¶æ€ï¼Œæœ‰éå¸¸å¤§çš„ä½œç”¨ã€‚")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("sar "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("n "),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DEV")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("sar"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("traffic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("åœ¨ä¸€äº›é€Ÿåº¦éå¸¸é«˜çš„æ¨¡å—ä¸Šï¼Œæ¯”å¦‚ Redisã€Kafkaï¼Œå°±ç»å¸¸å‘ç”Ÿè·‘æ»¡ç½‘å¡çš„æƒ…å†µã€‚è¡¨ç°å½¢å¼å°±æ˜¯ç½‘ç»œé€šä¿¡éå¸¸ç¼“æ…¢ã€‚")]),a._v(" "),s("p",[a._v("ï¼ˆ3ï¼‰"),s("strong",[a._v("è¿›ç¨‹èµ„æº")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("lsof "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("lsof"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("$"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("é€šè¿‡æŸ¥çœ‹è¿›ç¨‹ï¼Œèƒ½çœ‹åˆ°æ‰“å¼€äº†å“ªäº›æ–‡ä»¶ï¼Œå¯ä»¥ä»¥è¿›ç¨‹çš„ç»´åº¦æ¥æŸ¥çœ‹æ•´ä¸ªèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬æ¯æ¡ç½‘ç»œè¿æ¥ã€æ¯ä¸ªæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹åˆ°è¿æ¥åˆ°äº†å“ªäº›æœåŠ¡å™¨ã€ä½¿ç”¨äº†å“ªäº›èµ„æºã€‚è¿™ä¸ªå‘½ä»¤åœ¨èµ„æºéå¸¸å¤šçš„æƒ…å†µä¸‹ï¼Œè¾“å‡ºç¨æ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚")]),a._v(" "),s("p",[a._v("ï¼ˆ4ï¼‰"),s("strong",[a._v("CPU èµ„æº")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mpstat > $DUMP_DIR/mpstat.dump 2>&1\nvmstat 1 3 > $DUMP_DIR/vmstat.dump 2>&1\nsar -p ALL  > $DUMP_DIR/sar-cpu.dump  2>&1\nuptime > $DUMP_DIR/uptime.dump 2>&1\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("ä¸»è¦ç”¨äºè¾“å‡ºå½“å‰ç³»ç»Ÿçš„ CPU å’Œè´Ÿè½½ï¼Œä¾¿äºäº‹åæ’æŸ¥ã€‚")]),a._v(" "),s("p",[a._v("ï¼ˆ5ï¼‰"),s("strong",[a._v("I/O èµ„æº")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("iostat "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("x "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("iostat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("ä¸€èˆ¬ï¼Œä»¥è®¡ç®—ä¸ºä¸»çš„æœåŠ¡èŠ‚ç‚¹ï¼ŒI/O èµ„æºä¼šæ¯”è¾ƒæ­£å¸¸ï¼Œä½†æœ‰æ—¶ä¹Ÿä¼šå‘ç”Ÿé—®é¢˜ï¼Œæ¯”å¦‚"),s("strong",[a._v("æ—¥å¿—è¾“å‡ºè¿‡å¤šï¼Œæˆ–è€…ç£ç›˜é—®é¢˜")]),a._v("ç­‰ã€‚æ­¤å‘½ä»¤å¯ä»¥è¾“å‡ºæ¯å—ç£ç›˜çš„åŸºæœ¬æ€§èƒ½ä¿¡æ¯ï¼Œç”¨æ¥æ’æŸ¥ I/O é—®é¢˜ã€‚åœ¨ç¬¬ 8 è¯¾æ—¶ä»‹ç»çš„ GC æ—¥å¿—åˆ†ç£ç›˜é—®é¢˜ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å»å‘ç°ã€‚")]),a._v(" "),s("p",[a._v("ï¼ˆ6ï¼‰"),s("strong",[a._v("å†…å­˜é—®é¢˜")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("free "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("h "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("free"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("free å‘½ä»¤èƒ½å¤Ÿå¤§ä½“å±•ç°æ“ä½œç³»ç»Ÿçš„å†…å­˜æ¦‚å†µï¼Œè¿™æ˜¯æ•…éšœæ’æŸ¥ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹ï¼Œæ¯”å¦‚ SWAP å½±å“äº† GCï¼ŒSLAB åŒºæŒ¤å äº† JVM çš„å†…å­˜ã€‚")]),a._v(" "),s("p",[a._v("ï¼ˆ7ï¼‰"),s("strong",[a._v("å…¶ä»–å…¨å±€")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("ps "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ef "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("ps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\ndmesg "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("dmesg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\nsysctl "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("sysctl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("dmesg æ˜¯è®¸å¤šé™æ‚„æ‚„æ­»æ‰çš„æœåŠ¡ç•™ä¸‹çš„æœ€åä¸€ç‚¹çº¿ç´¢ã€‚å½“ç„¶ï¼Œps ä½œä¸ºæ‰§è¡Œé¢‘ç‡æœ€é«˜çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”±äºå†…æ ¸çš„é…ç½®å‚æ•°ï¼Œä¼šå¯¹ç³»ç»Ÿå’Œ JVM äº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¾“å‡ºäº†ä¸€ä»½ã€‚")]),a._v(" "),s("p",[a._v("ï¼ˆ8ï¼‰"),s("strong",[a._v("è¿›ç¨‹å¿«ç…§")]),a._v("ï¼Œæœ€åçš„é—è¨€ï¼ˆjinfoï¼‰")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("JDK_BIN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("jinfo $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jinfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("æ­¤å‘½ä»¤å°†è¾“å‡º Java çš„åŸºæœ¬è¿›ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬"),s("strong",[a._v("ç¯å¢ƒå˜é‡å’Œå‚æ•°é…ç½®")]),a._v("ï¼Œå¯ä»¥æŸ¥çœ‹æ˜¯å¦å› ä¸ºä¸€äº›é”™è¯¯çš„é…ç½®é€ æˆäº† JVM é—®é¢˜ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("ï¼ˆ9ï¼‰dump å †ä¿¡æ¯")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("JDK_BIN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("jstat "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("gcutil $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jstat"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("gcutil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("JDK_BIN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("jstat "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("gccapacity $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jstat"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("gccapacity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("jstat å°†è¾“å‡ºå½“å‰çš„ gc ä¿¡æ¯ã€‚ä¸€èˆ¬ï¼ŒåŸºæœ¬èƒ½å¤§ä½“çœ‹å‡ºä¸€ä¸ªç«¯å€ªï¼Œå¦‚æœä¸èƒ½ï¼Œå¯å°†å€ŸåŠ© jmap æ¥è¿›è¡Œåˆ†æã€‚")]),a._v(" "),s("p",[s("strong",[a._v("ï¼ˆ10ï¼‰å †ä¿¡æ¯")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("JDK_BIN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("jmap $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jmap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("JDK_BIN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("jmap "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("heap $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jmap"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("heap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("JDK_BIN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("jmap "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("histo $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jmap"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("histo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("JDK_BIN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("jmap "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("dump"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("format"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("$"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("heap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("bin $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("dev"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("jmap å°†ä¼šå¾—åˆ°å½“å‰ Java è¿›ç¨‹çš„ dump ä¿¡æ¯ã€‚å¦‚ä¸Šæ‰€ç¤ºï¼Œå…¶å®æœ€æœ‰ç”¨çš„å°±æ˜¯ç¬¬ 4 ä¸ªå‘½ä»¤ï¼Œä½†æ˜¯å‰é¢ä¸‰ä¸ªèƒ½å¤Ÿè®©ä½ åˆæ­¥å¯¹ç³»ç»Ÿæ¦‚å†µè¿›è¡Œå¤§ä½“åˆ¤æ–­ã€‚å› ä¸ºï¼Œç¬¬ 4 ä¸ªå‘½ä»¤äº§ç”Ÿçš„æ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½éå¸¸çš„å¤§ã€‚è€Œä¸”ï¼Œéœ€è¦ä¸‹è½½ä¸‹æ¥ï¼Œå¯¼å…¥ MAT è¿™æ ·çš„å·¥å…·è¿›è¡Œæ·±å…¥åˆ†æï¼Œæ‰èƒ½è·å–ç»“æœã€‚è¿™æ˜¯åˆ†æå†…å­˜æ³„æ¼ä¸€ä¸ªå¿…ç»çš„è¿‡ç¨‹ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("ï¼ˆ11ï¼‰JVM æ‰§è¡Œæ ˆ")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("JDK_BIN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("jstack $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jstack"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("jstack å°†ä¼šè·å–å½“æ—¶çš„æ‰§è¡Œæ ˆã€‚ä¸€èˆ¬ä¼šå¤šæ¬¡å–å€¼ï¼Œæˆ‘ä»¬è¿™é‡Œå–ä¸€æ¬¡å³å¯ã€‚è¿™äº›ä¿¡æ¯éå¸¸æœ‰ç”¨ï¼Œèƒ½å¤Ÿè¿˜åŸ Java è¿›ç¨‹ä¸­çš„çº¿ç¨‹æƒ…å†µã€‚")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("top "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Hp")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("b "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("n "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("  $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("top"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("$"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dump "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("ä¸ºäº†èƒ½å¤Ÿå¾—åˆ°æ›´åŠ ç²¾ç»†çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ top å‘½ä»¤ï¼Œæ¥è·å–è¿›ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹çš„ CPU ä¿¡æ¯ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥çœ‹åˆ°èµ„æºåˆ°åº•è€—è´¹åœ¨ä»€ä¹ˆåœ°æ–¹äº†ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("ï¼ˆ12ï¼‰é«˜çº§æ›¿è¡¥")])]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("kill "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("æœ‰æ—¶å€™ï¼Œjstack å¹¶ä¸èƒ½å¤Ÿè¿è¡Œï¼Œæœ‰å¾ˆå¤šåŸå› ï¼Œæ¯”å¦‚ Java è¿›ç¨‹å‡ ä¹ä¸å“åº”äº†ç­‰ä¹‹ç±»çš„æƒ…å†µã€‚æˆ‘ä»¬ä¼šå°è¯•å‘è¿›ç¨‹å‘é€ kill -3 ä¿¡å·ï¼Œè¿™ä¸ªä¿¡å·å°†ä¼šæ‰“å° jstack çš„ trace ä¿¡æ¯åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ˜¯ jstack çš„ä¸€ä¸ªæ›¿è¡¥æ–¹æ¡ˆã€‚")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("gcore "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("o $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("core $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PID")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("å¯¹äº jmap æ— æ³•æ‰§è¡Œçš„é—®é¢˜ï¼Œä¹Ÿæœ‰æ›¿è¡¥ï¼Œé‚£å°±æ˜¯ GDB ç»„ä»¶ä¸­çš„ gcoreï¼Œå°†ä¼šç”Ÿæˆä¸€ä¸ª core æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤å»ç”Ÿæˆ dumpï¼š")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("JDK_BIN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("jhsdb jmap "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("exe $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("JDK")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("java  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("core $"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DUMP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("core "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("binaryheap\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ol",{attrs:{start:"3"}},[s("li",[s("strong",[a._v("å†…å­˜æ³„æ¼çš„ç°è±¡")])])]),a._v(" "),s("p",[a._v("ç¨å¾®æä¸€ä¸‹ jmap å‘½ä»¤ï¼Œå®ƒåœ¨ 9 ç‰ˆæœ¬é‡Œè¢«å¹²æ‰äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ jhsdbï¼Œä½ å¯ä»¥åƒä¸‹é¢çš„å‘½ä»¤ä¸€æ ·ä½¿ç”¨ã€‚")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("jhsdb jmap  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("heap "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("pid  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("37340")]),a._v("\njhsdb jmap  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("pid  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("37288")]),a._v("\njhsdb jmap  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("histo "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("pid  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("37340")]),a._v("\njhsdb jmap  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("binaryheap "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("pid  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("37340")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("ä¸€èˆ¬å†…å­˜æº¢å‡ºï¼Œè¡¨ç°å½¢å¼å°±æ˜¯ Old åŒºçš„å ç”¨æŒç»­ä¸Šå‡ï¼Œå³ä½¿ç»è¿‡äº†å¤šè½® GC ä¹Ÿæ²¡æœ‰æ˜æ˜¾æ”¹å–„ã€‚æ¯”å¦‚ThreadLocalé‡Œé¢çš„GC Rootsï¼Œå†…å­˜æ³„æ¼çš„æ ¹æœ¬å°±æ˜¯ï¼Œè¿™äº›å¯¹è±¡å¹¶æ²¡æœ‰åˆ‡æ–­å’Œ GC Roots çš„å…³ç³»ï¼Œå¯é€šè¿‡ä¸€äº›å·¥å…·ï¼Œèƒ½å¤Ÿçœ‹åˆ°å®ƒä»¬çš„è”ç³»ã€‚")]),a._v(" "),s("h2",{attrs:{id:"_2ã€æŠ¥è¡¨å¼‚å¸¸-jvmè°ƒä¼˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2ã€æŠ¥è¡¨å¼‚å¸¸-jvmè°ƒä¼˜"}},[a._v("#")]),a._v(" 2ã€æŠ¥è¡¨å¼‚å¸¸ | JVMè°ƒä¼˜")]),a._v(" "),s("p",[a._v("æœ‰ä¸€ä¸ªæŠ¥è¡¨ç³»ç»Ÿï¼Œé¢‘ç¹å‘ç”Ÿå†…å­˜æº¢å‡ºï¼Œåœ¨é«˜å³°æœŸé—´ä½¿ç”¨æ—¶ï¼Œè¿˜ä¼šé¢‘ç¹çš„å‘ç”Ÿæ‹’ç»æœåŠ¡ï¼Œç”±äºå¤§å¤šæ•°ä½¿ç”¨è€…æ˜¯ç®¡ç†å‘˜è§’è‰²ï¼Œæ‰€ä»¥å¾ˆå¿«å°±åé¦ˆåˆ°ç ”å‘è¿™é‡Œã€‚")]),a._v(" "),s("p",[a._v("ä¸šåŠ¡åœºæ™¯æ˜¯ç”±äºæœ‰äº›ç»“æœé›†çš„å­—æ®µä¸æ˜¯å¤ªå…¨ï¼Œå› æ­¤éœ€è¦å¯¹ç»“æœé›†åˆè¿›è¡Œå¾ªç¯ï¼Œå¹¶é€šè¿‡ HttpClient è°ƒç”¨å…¶ä»–æœåŠ¡çš„æ¥å£è¿›è¡Œæ•°æ®å¡«å……ã€‚ä½¿ç”¨ Guava åšäº† JVM å†…ç¼“å­˜ï¼Œä½†æ˜¯å“åº”æ—¶é—´ä¾ç„¶å¾ˆé•¿ã€‚")]),a._v(" "),s("p",[a._v("åˆæ­¥æ’æŸ¥ï¼ŒJVM çš„èµ„æºå¤ªå°‘ã€‚æ¥å£ A æ¯æ¬¡è¿›è¡ŒæŠ¥è¡¨è®¡ç®—æ—¶ï¼Œéƒ½è¦æ¶‰åŠå‡ ç™¾å…†çš„å†…å­˜ï¼Œè€Œä¸”åœ¨å†…å­˜é‡Œé©»ç•™å¾ˆé•¿æ—¶é—´ï¼Œæœ‰äº›è®¡ç®—åˆéå¸¸è€— CPUï¼Œç‰¹åˆ«çš„â€œåƒâ€èµ„æºã€‚è€Œæˆ‘ä»¬åˆ†é…ç»™ JVM çš„å†…å­˜åªæœ‰ 3 GBï¼Œåœ¨å¤šäººè®¿é—®è¿™äº›æ¥å£çš„æ—¶å€™ï¼Œå†…å­˜å°±ä¸å¤Ÿç”¨äº†ï¼Œè¿›è€Œå‘ç”Ÿäº† OOMã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡åŠæ³•ï¼Œåªæœ‰å‡çº§æœºå™¨ã€‚æŠŠæœºå™¨é…ç½®å‡çº§åˆ° 4C8Gï¼Œç»™ JVM åˆ†é… 6GB çš„å†…å­˜ï¼Œè¿™æ · OOM é—®é¢˜å°±æ¶ˆå¤±äº†ã€‚ä½†éšä¹‹è€Œæ¥çš„æ˜¯é¢‘ç¹çš„ GC é—®é¢˜å’Œè¶…é•¿çš„ GC æ—¶é—´ï¼Œå¹³å‡ GC æ—¶é—´ç«Ÿç„¶æœ‰ 5 ç§’å¤šã€‚")]),a._v(" "),s("p",[a._v("è¿›ä¸€æ­¥ï¼Œç”±äºæŠ¥è¡¨ç³»ç»Ÿå’Œé«˜å¹¶å‘ç³»ç»Ÿä¸å¤ªä¸€æ ·ï¼Œå®ƒçš„å¯¹è±¡ï¼Œå­˜æ´»æ—¶é•¿å¤§å¾—å¤šï¼Œå¹¶ä¸èƒ½ä»…ä»…é€šè¿‡å¢åŠ å¹´è½»ä»£æ¥è§£å†³ï¼›è€Œä¸”ï¼Œå¦‚æœå¢åŠ äº†å¹´è½»ä»£ï¼Œé‚£ä¹ˆå¿…ç„¶å‡å°‘äº†è€å¹´ä»£çš„å¤§å°ï¼Œç”±äº CMS çš„ç¢ç‰‡å’Œæµ®åŠ¨åƒåœ¾é—®é¢˜ï¼Œæˆ‘ä»¬å¯ç”¨çš„ç©ºé—´å°±æ›´å°‘äº†ã€‚è™½ç„¶æœåŠ¡èƒ½å¤Ÿæ»¡è¶³ç›®å‰çš„éœ€æ±‚ï¼Œä½†è¿˜æœ‰ä¸€äº›ä¸å¤ªç¡®å®šçš„é£é™©ã€‚")]),a._v(" "),s("p",[a._v("ç¬¬ä¸€ï¼Œäº†è§£åˆ°ç¨‹åºä¸­æœ‰å¾ˆå¤šç¼“å­˜æ•°æ®å’Œé™æ€ç»Ÿè®¡æ•°æ®ï¼Œä¸ºäº†å‡å°‘ MinorGC çš„æ¬¡æ•°ï¼Œé€šè¿‡åˆ†æ GC æ—¥å¿—æ‰“å°çš„å¯¹è±¡å¹´é¾„åˆ†å¸ƒï¼ŒæŠŠ MaxTenuringThreshold å‚æ•°è°ƒæ•´åˆ°äº† 3ï¼ˆç‰¹æ®Šåœºæ™¯ç‰¹æ®Šçš„é…ç½®ï¼‰ã€‚è¿™ä¸ªå‚æ•°æ˜¯è®©å¹´è½»ä»£çš„è¿™äº›å¯¹è±¡ï¼Œèµ¶ç´§å›åˆ°è€å¹´ä»£å»ï¼Œä¸è¦è€å‘†åœ¨å¹´è½»ä»£é‡Œã€‚")]),a._v(" "),s("p",[a._v("ç¬¬äºŒï¼Œæˆ‘ä»¬çš„ GC æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå°±ä¸€å—å¼€äº†å‚æ•° CMSScavengeBeforeRemarkï¼Œä½¿å¾—åœ¨ CMS remark å‰ï¼Œå…ˆæ‰§è¡Œä¸€æ¬¡ Minor GC å°†æ–°ç”Ÿä»£æ¸…æ‰ã€‚åŒæ—¶é…åˆä¸Šä¸ªå‚æ•°ï¼Œå…¶æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒå¥½çš„ï¼Œä¸€æ–¹é¢ï¼Œå¯¹è±¡å¾ˆå¿«æ™‹å‡åˆ°äº†è€å¹´ä»£ï¼Œå¦ä¸€æ–¹é¢ï¼Œå¹´è½»ä»£çš„å¯¹è±¡åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯æœ‰é™çš„ï¼Œåœ¨æ•´ä¸ª MajorGC ä¸­å çš„æ—¶é—´ä¹Ÿæœ‰é™ã€‚")]),a._v(" "),s("p",[a._v("ç¬¬ä¸‰ï¼Œç”±äºç¼“å­˜çš„ä½¿ç”¨ï¼Œæœ‰å¤§é‡çš„å¼±å¼•ç”¨ï¼Œæ‹¿ä¸€æ¬¡é•¿è¾¾ 10 ç§’çš„ GC æ¥è¯´ã€‚æˆ‘ä»¬å‘ç°åœ¨ GC æ—¥å¿—é‡Œï¼Œå¤„ç† weak refs çš„æ—¶é—´è¾ƒé•¿ï¼Œè¾¾åˆ°äº† 4.5 ç§’ã€‚è¿™é‡Œå¯ä»¥åŠ å…¥å‚æ•° ParallelRefProcEnabled æ¥å¹¶è¡Œå¤„ç†Referenceï¼Œä»¥åŠ å¿«å¤„ç†é€Ÿåº¦ï¼Œç¼©çŸ­è€—æ—¶ã€‚")]),a._v(" "),s("p",[a._v("ä¼˜åŒ–ä¹‹åï¼Œæ•ˆæœä¸é”™ï¼Œä½†å¹¶ä¸æ˜¯ç‰¹åˆ«æ˜æ˜¾ã€‚ç»è¿‡è¯„ä¼°ï¼Œé’ˆå¯¹é«˜å³°æ—¶æœŸçš„æƒ…å†µè¿›è¡Œè°ƒç ”ï¼Œæˆ‘ä»¬å†³å®šå†æ¬¡æå‡æœºå™¨æ€§èƒ½ï¼Œæ”¹ç”¨ 8core16g çš„æœºå™¨ã€‚ä½†æ˜¯ï¼Œè¿™å¸¦æ¥å¦å¤–ä¸€ä¸ªé—®é¢˜ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("é«˜æ€§èƒ½çš„æœºå™¨å¸¦æ¥äº†éå¸¸å¤§çš„æœåŠ¡ååé‡")]),a._v("ï¼Œé€šè¿‡ jstat è¿›è¡Œç›‘æ§ï¼Œèƒ½å¤Ÿçœ‹åˆ°å¹´è½»ä»£çš„åˆ†é…é€Ÿç‡æ˜æ˜¾æé«˜ï¼Œä½†éšä¹‹è€Œæ¥çš„ MinorGC æ—¶é•¿å´å˜çš„ä¸å¯æ§ï¼Œæœ‰æ—¶å€™ä¼šè¶…è¿‡ 1 ç§’ã€‚ç´¯ç§¯çš„è¯·æ±‚é€ æˆäº†æ›´åŠ ä¸¥é‡çš„åæœã€‚")]),a._v(" "),s("p",[a._v("è¿™æ˜¯ç”±äºå †ç©ºé—´æ˜æ˜¾åŠ å¤§é€ æˆçš„å›æ”¶æ—¶é—´åŠ é•¿ã€‚ä¸ºäº†è·å–è¾ƒå°çš„åœé¡¿æ—¶é—´ï¼Œæˆ‘ä»¬åœ¨å †ä¸Š"),s("strong",[a._v("æ”¹ç”¨äº† G1 åƒåœ¾å›æ”¶å™¨")]),a._v("ï¼ŒæŠŠå®ƒçš„ç›®æ ‡è®¾å®šåœ¨ 200msã€‚G1 æ˜¯ä¸€æ¬¾éå¸¸ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸ä»…é€‚åˆå †å†…å­˜å¤§çš„åº”ç”¨ï¼ŒåŒæ—¶ä¹Ÿç®€åŒ–äº†è°ƒä¼˜çš„å·¥ä½œã€‚é€šè¿‡ä¸»è¦çš„å‚æ•°åˆå§‹å’Œæœ€å¤§å †ç©ºé—´ã€ä»¥åŠæœ€å¤§å®¹å¿çš„ GC æš‚åœç›®æ ‡ï¼Œå°±èƒ½å¾—åˆ°ä¸é”™çš„æ€§èƒ½ã€‚ä¿®æ”¹ä¹‹åï¼Œè™½ç„¶ GC æ›´åŠ é¢‘ç¹äº†ä¸€äº›ï¼Œä½†æ˜¯åœé¡¿æ—¶é—´éƒ½æ¯”è¾ƒå°ï¼Œåº”ç”¨çš„è¿è¡Œè¾ƒä¸ºå¹³æ»‘ã€‚")]),a._v(" "),s("p",[a._v("åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¹Ÿåªæ˜¯å‹‰å¼ºé¡¶ä½äº†å·²æœ‰çš„ä¸šåŠ¡ï¼Œä½†æ˜¯ï¼Œè¿™æ—¶å€™é¢†å¯¼å±‚é¢åˆå‘åŠ›ï¼Œ"),s("strong",[a._v("è¦æ±‚æŠ¥è¡¨ç³»ç»Ÿå¯ä»¥æ”¯æŒæœªæ¥ä¸¤å¹´ä¸šåŠ¡10åˆ°100å€çš„å¢é•¿")]),a._v("ï¼Œå¹¶ä¿æŒå…¶å¯ç”¨æ€§ï¼Œä½†æ˜¯è¿™ä¸ªâ€œåƒç–®ç™¾å­”â€çš„æŠ¥è¡¨ç³»ç»Ÿï¼Œç¨å¾®ä¸€å‹æµ‹ï¼Œå°±å®•æœºï¼Œé‚£å¦‚ä½•åº”å¯¹åå€ç™¾å€çš„å‹åŠ›å‘¢ ? ç¡¬ä»¶å³ä½¿å¯ä»¥åšåˆ°åŠ¨æ€æ‰©å®¹ï¼Œä½†æ˜¯æ¯•ç«Ÿä¹Ÿæœ‰æé™ã€‚")]),a._v(" "),s("p",[a._v("ä½¿ç”¨ MAT åˆ†æå †å¿«ç…§ï¼Œå‘ç°å¾ˆå¤šåœ°æ–¹å¯ä»¥é€šè¿‡ä»£ç ä¼˜åŒ–ï¼Œé‚£äº›å ç”¨å†…å­˜ç‰¹åˆ«å¤šçš„å¯¹è±¡ï¼š")]),a._v(" "),s("p",[a._v("1ã€select * å…¨é‡æ’æŸ¥ï¼Œåªå…è®¸è·å–å¿…é¡»çš„æ•°æ®")]),a._v(" "),s("p",[a._v("2ã€æŠ¥è¡¨ç³»ç»Ÿä¸­cacheå®é™…çš„å‘½ä¸­ç‡å¹¶ä¸é«˜ï¼Œå°†Guava çš„ Cache å¼•ç”¨çº§åˆ«æ”¹æˆå¼±å¼•ç”¨ï¼ˆWeakKeysï¼‰")]),a._v(" "),s("p",[a._v("3ã€é™åˆ¶æŠ¥è¡¨å¯¼å…¥æ–‡ä»¶å¤§å°ï¼ŒåŒæ—¶æ‹†åˆ†ç”¨æˆ·è¶…å¤§èŒƒå›´æŸ¥è¯¢å¯¼å‡ºè¯·æ±‚ã€‚")]),a._v(" "),s("p",[a._v("æ¯ä¸€æ­¥æ“ä½œéƒ½ä½¿å¾—JVMä½¿ç”¨å˜å¾—æ›´åŠ å¯ç”¨ï¼Œä¸€ç³»åˆ—ä¼˜åŒ–ä»¥åï¼Œæœºå™¨ç›¸åŒå‹æµ‹æ•°æ®æ€§èƒ½æå‡äº†æ•°å€ã€‚")]),a._v(" "),s("h2",{attrs:{id:"_3ã€å¤§å±å¼‚å¸¸-jucè°ƒä¼˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3ã€å¤§å±å¼‚å¸¸-jucè°ƒä¼˜"}},[a._v("#")]),a._v(" 3ã€å¤§å±å¼‚å¸¸ | JUCè°ƒä¼˜")]),a._v(" "),s("p",[a._v("æœ‰äº›æ•°æ®éœ€è¦ä½¿ç”¨ HttpClient æ¥è·å–è¿›è¡Œè¡¥å…¨ã€‚æä¾›æ•°æ®çš„æœåŠ¡æä¾›å•†æœ‰çš„å“åº”æ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šé€ æˆæœåŠ¡æ•´ä½“çš„é˜»å¡ã€‚")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEly1gobr4whjzwj30l1058dfx.jpg",alt:"img"}})]),a._v(" "),s("p",[a._v("æ¥å£ A é€šè¿‡ HttpClient è®¿é—®æœåŠ¡ 2ï¼Œå“åº” 100ms åè¿”å›ï¼›æ¥å£ B è®¿é—®æœåŠ¡ 3ï¼Œè€—æ—¶ 2 ç§’ã€‚HttpClient æœ¬èº«æ˜¯æœ‰ä¸€ä¸ªæœ€å¤§è¿æ¥æ•°é™åˆ¶çš„ï¼Œå¦‚æœæœåŠ¡ 3 è¿Ÿè¿Ÿä¸è¿”å›ï¼Œå°±ä¼šé€ æˆ HttpClient çš„è¿æ¥æ•°è¾¾åˆ°ä¸Šé™ï¼Œ"),s("strong",[a._v("æ¦‚æ‹¬æ¥è®²ï¼Œå°±æ˜¯åŒä¸€æœåŠ¡ï¼Œç”±äºä¸€ä¸ªè€—æ—¶éå¸¸é•¿çš„æ¥å£ï¼Œè¿›è€Œå¼•èµ·äº†æ•´ä½“çš„æœåŠ¡ä¸å¯ç”¨")])]),a._v(" "),s("p",[a._v("è¿™ä¸ªæ—¶å€™ï¼Œé€šè¿‡ jstack æ‰“å°æ ˆä¿¡æ¯ï¼Œä¼šå‘ç°å¤§å¤šæ•°ç«Ÿç„¶é˜»å¡åœ¨äº†æ¥å£ A ä¸Šï¼Œè€Œä¸æ˜¯è€—æ—¶æ›´é•¿çš„æ¥å£ Bï¼Œè¿™ä¸ªç°è±¡èµ·åˆååˆ†å…·æœ‰è¿·æƒ‘æ€§ï¼Œä¸è¿‡ç»è¿‡åˆ†æåï¼Œæˆ‘ä»¬çŒœæƒ³å…¶å®æ˜¯å› ä¸ºæ¥å£ A çš„é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œåœ¨é—®é¢˜å‘ç”Ÿç‚¹è¿›å…¥äº†æ›´å¤šçš„è¯·æ±‚ï¼Œå®ƒä»¬å…¨éƒ¨éƒ½é˜»å¡ä½çš„åŒæ—¶è¢«æ‰“å°å‡ºæ¥äº†ã€‚")]),a._v(" "),s("p",[a._v("ä¸ºäº†éªŒè¯è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ­å»ºäº†ä¸€ä¸ªdemo å·¥ç¨‹ï¼Œæ¨¡æ‹Ÿäº†ä¸¤ä¸ªä½¿ç”¨åŒä¸€ä¸ª HttpClient çš„æ¥å£ã€‚fast æ¥å£ç”¨æ¥è®¿é—®ç™¾åº¦ï¼Œå¾ˆå¿«å°±èƒ½è¿”å›ï¼›slow æ¥å£è®¿é—®è°·æ­Œï¼Œç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œä¼šé˜»å¡ç›´åˆ°è¶…æ—¶ï¼Œå¤§çº¦ 10 sã€‚ åˆ©ç”¨abå¯¹ä¸¤ä¸ªæ¥å£è¿›è¡Œå‹æµ‹ï¼ŒåŒæ—¶ä½¿ç”¨ jstack å·¥å…· dump å †æ ˆã€‚é¦–å…ˆä½¿ç”¨ jps å‘½ä»¤æ‰¾åˆ°è¿›ç¨‹å·ï¼Œç„¶åæŠŠç»“æœé‡å®šå‘åˆ°æ–‡ä»¶ï¼ˆå¯ä»¥å‚è€ƒ 10271.jstack æ–‡ä»¶ï¼‰ã€‚")]),a._v(" "),s("p",[a._v("è¿‡æ»¤ä¸€ä¸‹ nio å…³é”®å­—ï¼Œå¯ä»¥æŸ¥çœ‹ tomcat ç›¸å…³çš„çº¿ç¨‹ï¼Œè¶³è¶³æœ‰ 200 ä¸ªï¼Œè¿™å’Œ Spring Boot é»˜è®¤çš„ maxThreads ä¸ªæ•°ä¸è°‹è€Œåˆã€‚æ›´è¦å‘½çš„æ˜¯ï¼Œæœ‰å¤§å¤šæ•°çº¿ç¨‹ï¼Œéƒ½å¤„äº BLOCKED çŠ¶æ€ï¼Œè¯´æ˜çº¿ç¨‹ç­‰å¾…èµ„æºè¶…æ—¶ã€‚é€šè¿‡grep fast | wc -l åˆ†æï¼Œç¡®å®200ä¸ªä¸­æœ‰150ä¸ªéƒ½æ˜¯blockedçš„fastçš„è¿›ç¨‹ã€‚")]),a._v(" "),s("p",[a._v("é—®é¢˜æ‰¾åˆ°äº†ï¼Œè§£å†³æ–¹å¼å°±é¡ºåˆ©æˆç« äº†ã€‚")]),a._v(" "),s("p",[a._v("1ã€fastå’Œslowäº‰æŠ¢è¿æ¥èµ„æºï¼Œé€šè¿‡çº¿ç¨‹æ± é™æµæˆ–è€…ç†”æ–­å¤„ç†")]),a._v(" "),s("p",[a._v("2ã€æœ‰æ—¶å€™slowçš„çº¿ç¨‹ä¹Ÿä¸æ˜¯ä¸€ç›´slowï¼Œæ‰€ä»¥å°±å¾—åŠ å…¥ç›‘æ§")]),a._v(" "),s("p",[a._v("3ã€ä½¿ç”¨å¸¦countdownLaunchå¯¹çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºé€»è¾‘è¿›è¡Œæ§åˆ¶")]),a._v(" "),s("h2",{attrs:{id:"_4ã€æ¥å£å»¶è¿Ÿ-swapè°ƒä¼˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4ã€æ¥å£å»¶è¿Ÿ-swapè°ƒä¼˜"}},[a._v("#")]),a._v(" "),s("strong",[a._v("4ã€æ¥å£å»¶è¿Ÿ | SWAPè°ƒä¼˜")])]),a._v(" "),s("p",[a._v("æœ‰ä¸€ä¸ªå…³äºæœåŠ¡çš„æŸä¸ªå®ä¾‹ï¼Œç»å¸¸å‘ç”ŸæœåŠ¡å¡é¡¿ã€‚ç”±äºæœåŠ¡çš„å¹¶å‘é‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œæ¯å¤šåœé¡¿ 1 ç§’é’Ÿï¼Œå‡ ä¸‡ç”¨æˆ·çš„è¯·æ±‚å°±ä¼šæ„Ÿåˆ°å»¶è¿Ÿã€‚")]),a._v(" "),s("p",[a._v("æˆ‘ä»¬ç»Ÿè®¡ã€ç±»æ¯”äº†æ­¤æœåŠ¡å…¶ä»–å®ä¾‹çš„ CPUã€å†…å­˜ã€ç½‘ç»œã€I/O èµ„æºï¼ŒåŒºåˆ«å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥ä¸€åº¦æ€€ç–‘æ˜¯æœºå™¨ç¡¬ä»¶çš„é—®é¢˜ã€‚")]),a._v(" "),s("p",[a._v("æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹æ¯”äº†èŠ‚ç‚¹çš„ GC æ—¥å¿—ï¼Œå‘ç°æ— è®ºæ˜¯ Minor GCï¼Œè¿˜æ˜¯ Major GCï¼Œè¿™ä¸ªèŠ‚ç‚¹æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œéƒ½æ¯”å…¶ä»–å®ä¾‹é•¿å¾—å¤šã€‚")]),a._v(" "),s("p",[a._v("é€šè¿‡ä»”ç»†è§‚å¯Ÿï¼Œæˆ‘ä»¬å‘ç°åœ¨ GC å‘ç”Ÿçš„æ—¶å€™ï¼Œvmstat çš„ siã€so é£™å‡çš„éå¸¸ä¸¥é‡ï¼Œè¿™å’Œå…¶ä»–å®ä¾‹æœ‰ç€æ˜æ˜¾çš„ä¸åŒã€‚")]),a._v(" "),s("p",[a._v("ä½¿ç”¨ free å‘½ä»¤å†æ¬¡ç¡®è®¤ï¼Œå‘ç° SWAP åˆ†åŒºï¼Œä½¿ç”¨çš„æ¯”ä¾‹éå¸¸é«˜ï¼Œå¼•èµ·çš„å…·ä½“åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ")]),a._v(" "),s("p",[a._v("æ›´è¯¦ç»†çš„æ“ä½œç³»ç»Ÿå†…å­˜åˆ†å¸ƒï¼Œä» /proc/meminfo æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°å…·ä½“çš„é€»è¾‘å†…å­˜å—å¤§å°ï¼Œæœ‰å¤šè¾¾ 40 é¡¹çš„å†…å­˜ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éƒ½å¯ä»¥é€šè¿‡éå† /proc ç›®å½•çš„ä¸€äº›æ–‡ä»¶è·å–ã€‚æˆ‘ä»¬æ³¨æ„åˆ° slabtop å‘½ä»¤æ˜¾ç¤ºçš„æœ‰ä¸€äº›å¼‚å¸¸ï¼Œdentryï¼ˆç›®å½•é«˜é€Ÿç¼“å†²ï¼‰å ç”¨éå¸¸é«˜ã€‚")]),a._v(" "),s("p",[a._v("é—®é¢˜æœ€ç»ˆå®šä½åˆ°æ˜¯ç”±äºæŸä¸ªè¿ç»´å·¥ç¨‹å¸ˆåˆ é™¤æ—¥å¿—æ—¶ï¼Œå®šæ—¶æ‰§è¡Œäº†ä¸€å¥å‘½ä»¤ï¼š")]),a._v(" "),s("p",[a._v('find / | grep "xxx.log"')]),a._v(" "),s("p",[a._v("ä»–æ˜¯æƒ³æ‰¾ä¸€ä¸ªå«åš è¦è¢«åˆ é™¤ çš„æ—¥å¿—æ–‡ä»¶ï¼Œçœ‹çœ‹åœ¨å“ªå°æœåŠ¡å™¨ä¸Šï¼Œç»“æœï¼Œè¿™äº›è€æœåŠ¡å™¨ç”±äºæ–‡ä»¶å¤ªå¤šï¼Œæ‰«æåè¿™äº›æ–‡ä»¶ä¿¡æ¯éƒ½ç¼“å­˜åˆ°äº† slab åŒºä¸Šã€‚è€ŒæœåŠ¡å™¨å¼€äº† swapï¼Œæ“ä½œç³»ç»Ÿå‘ç°ç‰©ç†å†…å­˜å æ»¡åï¼Œå¹¶æ²¡æœ‰ç«‹å³é‡Šæ”¾ cacheï¼Œå¯¼è‡´æ¯æ¬¡ GC éƒ½è¦å’Œç¡¬ç›˜æ‰“ä¸€æ¬¡äº¤é“ã€‚")]),a._v(" "),s("p",[s("strong",[a._v("è§£å†³æ–¹å¼å°±æ˜¯å…³é—­ SWAP åˆ†åŒºã€‚")])]),a._v(" "),s("p",[a._v("swap æ˜¯å¾ˆå¤šæ€§èƒ½åœºæ™¯çš„ä¸‡æ¶ä¹‹æºï¼Œå»ºè®®ç¦ç”¨ã€‚åœ¨é«˜å¹¶å‘ SWAP ç»å¯¹èƒ½è®©ä½ ä½“éªŒåˆ°å®ƒé­”é¬¼æ€§çš„ä¸€é¢ï¼šè¿›ç¨‹å€’æ˜¯æ­»ä¸äº†äº†ï¼Œä½† GC æ—¶é—´é•¿çš„å´è®©äººæ— æ³•å¿å—ã€‚")]),a._v(" "),s("h2",{attrs:{id:"_5ã€å†…å­˜æº¢å‡º-cacheè°ƒä¼˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5ã€å†…å­˜æº¢å‡º-cacheè°ƒä¼˜"}},[a._v("#")]),a._v(" 5ã€"),s("strong",[a._v("å†…å­˜æº¢å‡º | Cacheè°ƒä¼˜")])]),a._v(" "),s("blockquote",[s("p",[a._v("æœ‰ä¸€æ¬¡çº¿ä¸Šé‡åˆ°æ•…éšœï¼Œé‡æ–°å¯åŠ¨åï¼Œä½¿ç”¨ jstat å‘½ä»¤ï¼Œå‘ç° Old åŒºä¸€ç›´åœ¨å¢é•¿ã€‚æˆ‘ä½¿ç”¨ jmap å‘½ä»¤ï¼Œå¯¼å‡ºäº†ä¸€ä»½çº¿ä¸Šå †æ ˆï¼Œç„¶åä½¿ç”¨ MAT è¿›è¡Œåˆ†æï¼Œé€šè¿‡å¯¹ GC Roots çš„åˆ†æï¼Œå‘ç°äº†ä¸€ä¸ªéå¸¸å¤§çš„ HashMap å¯¹è±¡ï¼Œè¿™ä¸ªåŸæœ¬æ˜¯å…¶ä»–åŒäº‹åšç¼“å­˜ç”¨çš„ï¼Œä½†æ˜¯åšäº†ä¸€ä¸ªæ— ç•Œç¼“å­˜ï¼Œæ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´æˆ–è€… LRU ç­–ç•¥ï¼Œåœ¨ä½¿ç”¨ä¸Šåˆæ²¡æœ‰é‡å†™keyç±»å¯¹è±¡çš„hashcodeå’Œequalsæ–¹æ³•ï¼Œå¯¹è±¡æ— æ³•å–å‡ºä¹Ÿç›´æ¥é€ æˆäº†å †å†…å­˜å ç”¨ä¸€ç›´ä¸Šå‡ï¼Œåæ¥ï¼Œå°†è¿™ä¸ªç¼“å­˜æ”¹æˆ guava çš„ Cacheï¼Œå¹¶è®¾ç½®äº†å¼±å¼•ç”¨ï¼Œæ•…éšœå°±æ¶ˆå¤±äº†ã€‚")]),a._v(" "),s("p",[a._v("å…³äºæ–‡ä»¶å¤„ç†å™¨çš„åº”ç”¨ï¼Œåœ¨è¯»å–æˆ–è€…å†™å…¥ä¸€äº›æ–‡ä»¶ä¹‹åï¼Œç”±äºå‘ç”Ÿäº†ä¸€äº›å¼‚å¸¸ï¼Œ"),s("strong",[a._v("close æ–¹æ³•åˆæ²¡æœ‰æ”¾åœ¨ finally")]),a._v(" å—é‡Œé¢ï¼Œé€ æˆäº†æ–‡ä»¶å¥æŸ„çš„æ³„æ¼ã€‚ç”±äºæ–‡ä»¶å¤„ç†ååˆ†é¢‘ç¹ï¼Œäº§ç”Ÿäº†ä¸¥é‡çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚")])]),a._v(" "),s("p",[a._v("å†…å­˜æº¢å‡ºæ˜¯ä¸€ä¸ªç»“æœï¼Œè€Œ"),s("strong",[a._v("å†…å­˜æ³„æ¼")]),a._v("æ˜¯ä¸€ä¸ªåŸå› ã€‚å†…å­˜æº¢å‡ºçš„åŸå› æœ‰"),s("strong",[a._v("å†…å­˜ç©ºé—´ä¸è¶³ã€é…ç½®é”™è¯¯")]),a._v("ç­‰å› ç´ ã€‚ä¸€äº›é”™è¯¯çš„ç¼–ç¨‹æ–¹å¼ï¼Œä¸å†è¢«ä½¿ç”¨çš„å¯¹è±¡ã€æ²¡æœ‰è¢«å›æ”¶ã€æ²¡æœ‰åŠæ—¶åˆ‡æ–­ä¸ GC Roots çš„è”ç³»ï¼Œè¿™å°±æ˜¯å†…å­˜æ³„æ¼ã€‚")]),a._v(" "),s("p",[a._v("ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰å›¢é˜Ÿä½¿ç”¨äº† HashMap åšç¼“å­˜ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´æˆ–è€… LRU ç­–ç•¥ï¼Œé€ æˆäº†æ”¾å…¥ Map å¯¹è±¡çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œè€Œäº§ç”Ÿäº†å†…å­˜æ³„æ¼ã€‚")]),a._v(" "),s("p",[a._v("å†æ¥çœ‹ä¸€ä¸ªç»å¸¸å‘ç”Ÿçš„å†…å­˜æ³„æ¼çš„ä¾‹å­ï¼Œä¹Ÿæ˜¯ç”±äº HashMap äº§ç”Ÿçš„ã€‚ä»£ç å¦‚ä¸‹ï¼Œç”±äºæ²¡æœ‰é‡å†™ Key ç±»çš„ hashCode å’Œ equals æ–¹æ³•ï¼Œé€ æˆäº†æ”¾å…¥ HashMap çš„æ‰€æœ‰å¯¹è±¡éƒ½æ— æ³•è¢«å–å‡ºæ¥ï¼Œå®ƒä»¬å’Œå¤–ç•Œå¤±è”äº†ã€‚æ‰€ä»¥ä¸‹é¢çš„ä»£ç ç»“æœæ˜¯ nullã€‚")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//leak example")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HashMap")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Map")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HashMapLeakDemo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Key")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("title "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" map "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HashMap")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Integer")]),a._v(" integer "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("integer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br")])]),s("p",[a._v("å³ä½¿æä¾›äº† equals æ–¹æ³•å’Œ hashCode æ–¹æ³•ï¼Œä¹Ÿè¦éå¸¸å°å¿ƒï¼Œå°½é‡é¿å…ä½¿ç”¨è‡ªå®šä¹‰çš„å¯¹è±¡ä½œä¸º Keyã€‚")]),a._v(" "),s("p",[a._v("å†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå…³äºæ–‡ä»¶å¤„ç†å™¨çš„åº”ç”¨ï¼Œåœ¨è¯»å–æˆ–è€…å†™å…¥ä¸€äº›æ–‡ä»¶ä¹‹åï¼Œç”±äºå‘ç”Ÿäº†ä¸€äº›å¼‚å¸¸ï¼Œ"),s("strong",[a._v("close æ–¹æ³•åˆæ²¡æœ‰æ”¾åœ¨ finally")]),a._v(" å—é‡Œé¢ï¼Œé€ æˆäº†æ–‡ä»¶å¥æŸ„çš„æ³„æ¼ã€‚ç”±äºæ–‡ä»¶å¤„ç†ååˆ†é¢‘ç¹ï¼Œäº§ç”Ÿäº†ä¸¥é‡çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚")]),a._v(" "),s("h2",{attrs:{id:"_6ã€cpué£™é«˜-æ­»å¾ªç¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6ã€cpué£™é«˜-æ­»å¾ªç¯"}},[a._v("#")]),a._v(" 6ã€CPUé£™é«˜ | æ­»å¾ªç¯")]),a._v(" "),s("p",[a._v("æˆ‘ä»¬æœ‰ä¸ªçº¿ä¸Šåº”ç”¨ï¼Œå•èŠ‚ç‚¹åœ¨è¿è¡Œä¸€æ®µæ—¶é—´åï¼ŒCPU çš„ä½¿ç”¨ä¼šé£™å‡ï¼Œä¸€æ—¦é£™å‡ï¼Œä¸€èˆ¬æ€€ç–‘æŸä¸ªä¸šåŠ¡é€»è¾‘çš„è®¡ç®—é‡å¤ªå¤§ï¼Œæˆ–è€…æ˜¯è§¦å‘äº†æ­»å¾ªç¯ï¼ˆæ¯”å¦‚è‘—åçš„ HashMap é«˜å¹¶å‘å¼•èµ·çš„æ­»å¾ªç¯ï¼‰ï¼Œä½†æ’æŸ¥åˆ°æœ€åå…¶å®æ˜¯ GC çš„é—®é¢˜ã€‚")]),a._v(" "),s("p",[a._v("ï¼ˆ1ï¼‰ä½¿ç”¨ top å‘½ä»¤ï¼ŒæŸ¥æ‰¾åˆ°ä½¿ç”¨ CPU æœ€å¤šçš„æŸä¸ªè¿›ç¨‹ï¼Œè®°å½•å®ƒçš„ pidã€‚ä½¿ç”¨ Shift + P å¿«æ·é”®å¯ä»¥æŒ‰ CPU çš„ä½¿ç”¨ç‡è¿›è¡Œæ’åºã€‚")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("top\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("ï¼ˆ2ï¼‰å†æ¬¡ä½¿ç”¨ top å‘½ä»¤ï¼ŒåŠ  -H å‚æ•°ï¼ŒæŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä¸­ä½¿ç”¨ CPU æœ€å¤šçš„æŸä¸ªçº¿ç¨‹ï¼Œè®°å½•çº¿ç¨‹çš„ IDã€‚")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("top "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Hp")]),a._v(" $pid\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("ï¼ˆ3ï¼‰ä½¿ç”¨ printf å‡½æ•°ï¼Œå°†åè¿›åˆ¶çš„ tid è½¬åŒ–æˆåå…­è¿›åˆ¶ã€‚")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("printf "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("%")]),a._v("x $tid\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("ï¼ˆ4ï¼‰ä½¿ç”¨ jstack å‘½ä»¤ï¼ŒæŸ¥çœ‹ Java è¿›ç¨‹çš„çº¿ç¨‹æ ˆã€‚")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("jstack $pid "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("$pid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("log\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("ï¼ˆ5ï¼‰ä½¿ç”¨ less å‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶ï¼Œå¹¶æŸ¥æ‰¾åˆšæ‰è½¬åŒ–çš„åå…­è¿›åˆ¶ tidï¼Œæ‰¾åˆ°å‘ç”Ÿé—®é¢˜çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("less $pid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("log\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("æˆ‘ä»¬åœ¨ jstack æ—¥å¿—æœå…³é”®å­—DEADï¼Œä»¥åŠä¸­æ‰¾åˆ°äº† CPU ä½¿ç”¨æœ€å¤šçš„å‡ ä¸ªçº¿ç¨‹idã€‚")]),a._v(" "),s("p",[a._v("å¯ä»¥çœ‹åˆ°é—®é¢˜å‘ç”Ÿçš„æ ¹æºï¼Œæ˜¯æˆ‘ä»¬çš„å †å·²ç»æ»¡äº†ï¼Œä½†æ˜¯åˆæ²¡æœ‰å‘ç”Ÿ OOMï¼Œäºæ˜¯ GC è¿›ç¨‹å°±ä¸€ç›´åœ¨é‚£é‡Œå›æ”¶ï¼Œå›æ”¶çš„æ•ˆæœåˆéå¸¸ä¸€èˆ¬ï¼Œé€ æˆ CPU å‡é«˜åº”ç”¨å‡æ­»ã€‚æ¥ä¸‹æ¥çš„å…·ä½“é—®é¢˜æ’æŸ¥ï¼Œå°±éœ€è¦æŠŠå†…å­˜ dump ä¸€ä»½ä¸‹æ¥ï¼Œä½¿ç”¨ MAT ç­‰å·¥å…·åˆ†æå…·ä½“åŸå› äº†ã€‚")])])}),[],!1,null,null,null);s.default=r.exports}}]);