(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{560:function(_,v,t){"use strict";t.r(v);var p=t(1),r=Object(p.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h1",{attrs:{id:"nginx-è´Ÿè½½å‡è¡¡ä¸ç”Ÿäº§ç¯å¢ƒåº”ç”¨"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#nginx-è´Ÿè½½å‡è¡¡ä¸ç”Ÿäº§ç¯å¢ƒåº”ç”¨"}},[_._v("#")]),_._v(" "),v("strong",[_._v("Nginx è´Ÿè½½å‡è¡¡ä¸ç”Ÿäº§ç¯å¢ƒåº”ç”¨")])]),_._v(" "),v("p",[v("strong",[_._v("æ¦‚è¦ï¼š")])]),_._v(" "),v("p",[_._v("\\1.   Nginx åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡")]),_._v(" "),v("p",[_._v("\\2.   Nginx å®ç°é«˜é€Ÿç¼“å­˜")]),_._v(" "),v("p",[_._v("\\3.   Nginx æ€§èƒ½å‚æ•°è°ƒä¼˜")]),_._v(" "),v("p",[_._v("ä¸€ã€Nginx åå‘ä»£ç†å®ç°")]),_._v(" "),v("p",[_._v("çŸ¥è¯†ç‚¹ï¼š")]),_._v(" "),v("p",[_._v("\\1.   åå‘ä»£ç†åŸºæœ¬é…ç½®")]),_._v(" "),v("p",[_._v("\\2.   è´Ÿè½½å‡è¡¡é…ç½®ä¸å‚æ•°è§£æ")]),_._v(" "),v("p",[_._v("\\3.   è´Ÿè½½å‡è¡¡ç®—æ³•è¯¦è§£")]),_._v(" "),v("p",[_._v("\\1.  åå‘ä»£ç†åŸºæœ¬é…ç½®")]),_._v(" "),v("p",[_._v("æé—®ï¼šä»€ä¹ˆæ˜¯åå‘ä»£ç†å…¶ä¸æ­£å‘ä»£ç†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ")]),_._v(" "),v("p",[v("strong",[_._v("æ­£å‘ä»£ç†çš„æ¦‚å¿µï¼š")])]),_._v(" "),v("p",[_._v("æ­£å‘ä»£ç†æ˜¯æŒ‡å®¢æˆ·ç«¯ä¸ç›®æ ‡æœåŠ¡å™¨ä¹‹é—´å¢åŠ ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ç›´æ¥è®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨ç”±ä»£ç†æœåŠ¡å™¨è®¿é—®ç›®æ ‡æœåŠ¡å™¨å¹¶è¿”å›å®¢æˆ·ç«¯å¹¶è¿”å› ã€‚è¿™ä¸ªè¿‡ç¨‹å½“ä¸­å®¢æˆ·ç«¯éœ€è¦çŸ¥é“ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œå¹¶é…ç½®è¿æ¥ã€‚")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/365147/1586935864446-044eb86b-ac9b-4c62-8ee8-82a8345095d4.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_14%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),_._v(" "),v("p",[v("strong",[_._v("åå‘ä»£ç†çš„æ¦‚å¿µï¼š")])]),_._v(" "),v("p",[_._v("åå‘ä»£ç†æ˜¯æŒ‡ å®¢æˆ·ç«¯è®¿é—®ç›®æ ‡æœåŠ¡å™¨ï¼Œåœ¨ç›®æ ‡æœåŠ¡å†…éƒ¨æœ‰ä¸€ä¸ªç»Ÿä¸€æ¥å…¥ç½‘å…³å°†è¯·æ±‚è½¬å‘è‡³åç«¯çœŸæ­£å¤„ç†çš„æœåŠ¡å™¨å¹¶è¿”å›ç»“æœã€‚è¿™ä¸ªè¿‡ç¨‹å½“ä¸­å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œä»£ç†å¯¹å®¢æˆ·ç«¯è€Œè¨€æ˜¯é€æ˜çš„ã€‚")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/365147/1586935876767-bc88f106-ae55-4027-a268-4fd9267bf4b1.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_15%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),_._v(" "),v("p",[v("strong",[_._v("åå‘ä»£ç†ä¸æ­£å‘ä»£ç†çš„åŒºåˆ«")])]),_._v(" "),v("table",[v("thead",[v("tr",[v("th"),_._v(" "),v("th",[v("strong",[_._v("æ­£å‘ä»£ç†")])]),_._v(" "),v("th",[v("strong",[_._v("åå‘ä»£ç†")])])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("ä»£ç†æœåŠ¡å™¨ä½ç½®")]),_._v(" "),v("td",[_._v("å®¢æˆ·ç«¯ä¸æœåŠ¡éƒ½èƒ½è¿æ¥çš„ä»¬ä½ç½®")]),_._v(" "),v("td",[_._v("ç›®æ ‡æœåŠ¡å™¨å†…éƒ¨")])]),_._v(" "),v("tr",[v("td",[_._v("ä¸»è¦ä½œç”¨")]),_._v(" "),v("td",[_._v("å±è”½å®¢æˆ·ç«¯IPã€é›†ä¸­å¼ç¼“å­˜ã€è§£å†³å®¢æˆ·ç«¯ä¸èƒ½ç›´è¿æœåŠ¡ç«¯çš„é—®é¢˜ã€‚")]),_._v(" "),v("td",[_._v("å±è”½æœåŠ¡ç«¯å†…éƒ¨å®ç°ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€‚")])]),_._v(" "),v("tr",[v("td",[_._v("åº”ç”¨åœºæ™¯")]),_._v(" "),v("td",[_._v("çˆ¬è™«ã€ç¿»å¢™ã€maven   çš„nexus æœåŠ¡")]),_._v(" "),v("td",[_._v("Nginx ã€Apacheè´Ÿè½½å‡è¡¡åº”ç”¨")])])])]),_._v(" "),v("p",[v("strong",[_._v("Nginx****ä»£ç†åŸºæœ¬é…ç½®")])]),_._v(" "),v("p",[_._v("Nginx ä»£ç†åªéœ€è¦é…ç½® location ä¸­é…ç½®proxy_pass å±æ€§å³å¯ã€‚å…¶æŒ‡å‘ä»£ç†çš„æœåŠ¡å™¨åœ°å€ã€‚")]),_._v(" "),v("p",[_._v("# æ­£å‘ä»£ç†åˆ°baidu æœåŠ¡")]),_._v(" "),v("p",[_._v("location = /baidu.html {")]),_._v(" "),v("p",[_._v("â€‹     proxy_pass http://www.baidu.com;")]),_._v(" "),v("p",[_._v("}")]),_._v(" "),v("p",[_._v("# åå‘ä»£ç†è‡³ æœ¬æœºçš„8010æœåŠ¡")]),_._v(" "),v("p",[_._v("location /luban/ {")]),_._v(" "),v("p",[_._v("proxy_pass http://127.0.0.1:8010;")]),_._v(" "),v("p",[_._v("}")]),_._v(" "),v("p",[v("strong",[_._v("ä»£ç†ç›¸å…³å‚æ•°ï¼š")])]),_._v(" "),v("p",[_._v("proxy_pass      # ä»£ç†æœåŠ¡")]),_._v(" "),v("p",[_._v("proxy_redirect off;  # æ˜¯å¦å…è®¸é‡å®šå‘")]),_._v(" "),v("p",[_._v("proxy_set_header Host $host; # ä¼  header å‚æ•°è‡³åç«¯æœåŠ¡")]),_._v(" "),v("p",[_._v("proxy_set_header X-Forwarded-For $remote_addr; # è®¾ç½®request header å³å®¢æˆ·ç«¯IP åœ°å€")]),_._v(" "),v("p",[_._v("proxy_connect_timeout 90; # è¿æ¥ä»£ç†æœåŠ¡è¶…æ—¶æ—¶é—´")]),_._v(" "),v("p",[_._v("proxy_send_timeout 90; # è¯·æ±‚å‘é€æœ€å¤§æ—¶é—´")]),_._v(" "),v("p",[_._v("proxy_read_timeout 90; # è¯»å–æœ€å¤§æ—¶é—´")]),_._v(" "),v("p",[_._v("proxy_buffer_size 4k;")]),_._v(" "),v("p",[_._v("proxy_buffers 4 32k;")]),_._v(" "),v("p",[_._v("proxy_busy_buffers_size 64k;")]),_._v(" "),v("p",[_._v("proxy_temp_file_write_size 64k;")]),_._v(" "),v("p",[_._v("2.è´Ÿè½½å‡è¡¡é…ç½®ä¸å‚æ•°è§£æ")]),_._v(" "),v("p",[_._v("é€šè¿‡proxy_pass å¯ä»¥æŠŠè¯·æ±‚ä»£ç†è‡³åç«¯æœåŠ¡ï¼Œä½†æ˜¯ä¸ºäº†å®ç°æ›´é«˜çš„è´Ÿè½½åŠæ€§èƒ½ï¼Œ æˆ‘ä»¬çš„åç«¯æœåŠ¡é€šå¸¸æ˜¯å¤šä¸ªï¼Œ è¿™ä¸ªæ˜¯æ—¶å€™å¯ä»¥é€šè¿‡upstream æ¨¡å—å®ç°è´Ÿè½½å‡è¡¡ã€‚")]),_._v(" "),v("p",[v("strong",[_._v("æ¼”ç¤º****upstream")]),_._v(" "),v("strong",[_._v("çš„å®ç°ã€‚")])]),_._v(" "),v("p",[_._v("upstream backend {")]),_._v(" "),v("p",[_._v("server 127.0.0.1:8010 weight=1;")]),_._v(" "),v("p",[_._v("server 127.0.0.1:8080 weight=2;")]),_._v(" "),v("p",[_._v("server 127.0.0.1:8030 weight=1 backup;")]),_._v(" "),v("p",[_._v("}")]),_._v(" "),v("p",[_._v("location / {")]),_._v(" "),v("p",[_._v("proxy_pass http://backend;")]),_._v(" "),v("p",[_._v("}")]),_._v(" "),v("p",[v("strong",[_._v("upstream")]),_._v(" "),v("strong",[_._v("ç›¸å…³å‚æ•°")]),_._v("**ğŸ˜—*")]),_._v(" "),v("p",[_._v("l server  åå‘æœåŠ¡åœ°å€ åŠ ç«¯å£")]),_._v(" "),v("p",[_._v("l "),v("strong",[_._v("weight")]),_._v("  æƒé‡")]),_._v(" "),v("p",[_._v("l "),v("strong",[_._v("max_fails")]),_._v("  å¤±è´¥å¤šå°‘æ¬¡ è®¤ä¸ºä¸»æœºå·²æŒ‚æ‰åˆ™ï¼Œè¸¢å‡º")]),_._v(" "),v("p",[_._v("l "),v("strong",[_._v("fail_timeout")]),_._v("    è¸¢å‡ºåé‡æ–°æ¢æµ‹æ—¶é—´")]),_._v(" "),v("p",[_._v("l "),v("strong",[_._v("backup")]),_._v(" å¤‡ç”¨æœåŠ¡")]),_._v(" "),v("p",[_._v("l "),v("strong",[_._v("max_conns")]),_._v(" å…è®¸æœ€å¤§è¿æ¥æ•°")]),_._v(" "),v("p",[_._v("l "),v("strong",[_._v("slow_start")]),_._v("  å½“èŠ‚ç‚¹æ¢å¤ï¼Œä¸ç«‹å³åŠ å…¥,è€Œæ˜¯ç­‰å¾… slow_start ååŠ å…¥æœåŠ¡å¯¹åˆ—ã€‚")]),_._v(" "),v("p",[_._v("3.upstream è´Ÿè½½å‡è¡¡ç®—æ³•ä»‹ç»")]),_._v(" "),v("p",[_._v("l "),v("strong",[_._v("ll+weight")]),_._v("**ï¼š** è½®è¯¢åŠ æƒé‡ (é»˜è®¤)")]),_._v(" "),v("p",[_._v("l "),v("strong",[_._v("ip_hash :")]),_._v(" åŸºäºHash è®¡ç®— ,ç”¨äºä¿æŒsession ä¸€è‡³æ€§")]),_._v(" "),v("p",[_._v("l "),v("strong",[_._v("url_hash:")]),_._v(" é™æ€èµ„æºç¼“å­˜,èŠ‚çº¦å­˜å‚¨ï¼ŒåŠ å¿«é€Ÿåº¦ï¼ˆç¬¬ä¸‰æ–¹ï¼‰")]),_._v(" "),v("p",[_._v("l "),v("strong",[_._v("least_conn")]),_._v(" ï¼šæœ€å°‘é“¾æ¥ï¼ˆç¬¬ä¸‰æ–¹ï¼‰")]),_._v(" "),v("p",[_._v("l "),v("strong",[_._v("least_time")]),_._v(" ï¼šæœ€å°çš„å“åº”æ—¶é—´,è®¡ç®—èŠ‚ç‚¹å¹³å‡å“åº”æ—¶é—´ï¼Œç„¶åå–å“åº”æœ€å¿«çš„é‚£ä¸ªï¼Œåˆ†é…æ›´é«˜æƒé‡ï¼ˆç¬¬ä¸‰æ–¹ï¼‰")]),_._v(" "),v("p",[_._v("äºŒã€Nginx é«˜é€Ÿç¼“å­˜")]),_._v(" "),v("p",[_._v("çŸ¥è¯†ç‚¹ï¼š")]),_._v(" "),v("p",[_._v("\\1.   ç¼“å­˜æ¡ˆä¾‹åˆ†æ")]),_._v(" "),v("p",[_._v("\\2.   Nginx é™æ€ç¼“å­˜åŸºæœ¬é…ç½®")]),_._v(" "),v("p",[_._v("\\3.   ç¼“å­˜æ›´æ–°")]),_._v(" "),v("p",[_._v("1ã€æ¡ˆä¾‹åˆ†æï¼š")]),_._v(" "),v("p",[_._v("â€‹    æŸç”µå•†å¹³å°å•†å“è¯¦æƒ…é¡µéœ€è¦å®ç° 700+ QPSï¼Œå¦‚ä½•ç€æ‰‹å»åšï¼Ÿ")]),_._v(" "),v("p",[_._v("\\1.   é¦–å…ˆä¸ºåˆ†æä¸€ä¸‹ä¸€ä¸ªå•†å“è¯¦æƒ…é¡µæœ‰å“ªäº›ä¿¡æ¯")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/365147/1586936062792-0da6b2e3-3b38-40ce-9acc-e8a84f57c513.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_16%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),_._v(" "),v("p",[_._v("â€‹    ä»ä¸­å¾—å‡º å•†å“è¯¦æƒ…é¡µä¾æ‡’äº†")]),_._v(" "),v("p",[v("strong",[_._v("å¯¹äºå•†å“è¯¦æƒ…é¡µæ¶‰åŠäº†å¦‚ä¸‹ä¸»è¦æœåŠ¡ï¼š")])]),_._v(" "),v("p",[_._v("l å•†å“è¯¦æƒ…é¡µHTMLé¡µé¢æ¸²æŸ“")]),_._v(" "),v("p",[_._v("l ä»·æ ¼æœåŠ¡")]),_._v(" "),v("p",[_._v("l  ä¿ƒé”€æœåŠ¡")]),_._v(" "),v("p",[_._v("l  åº“å­˜çŠ¶æ€/é…é€è‡³æœåŠ¡")]),_._v(" "),v("p",[_._v("l  å¹¿å‘Šè¯æœåŠ¡")]),_._v(" "),v("p",[_._v("l  é¢„å”®/ç§’æ€æœåŠ¡")]),_._v(" "),v("p",[_._v("l  è¯„ä»·æœåŠ¡")]),_._v(" "),v("p",[_._v("l  è¯•ç”¨æœåŠ¡")]),_._v(" "),v("p",[_._v("l  æ¨èæœåŠ¡")]),_._v(" "),v("p",[_._v("l  å•†å“ä»‹ç»æœåŠ¡")]),_._v(" "),v("p",[_._v("l  å„å“ç±»ç›¸å…³çš„ä¸€äº›ç‰¹æ®ŠæœåŠ¡")]),_._v(" "),v("p",[v("strong",[_._v("è§£å†³æ–¹æ¡ˆï¼š")])]),_._v(" "),v("p",[_._v("\\1.   é‡‡ç”¨Ajax åŠ¨æ€åŠ è½½ ä»·æ ¼ã€å¹¿å‘Šã€åº“å­˜ç­‰æœåŠ¡")]),_._v(" "),v("p",[_._v("\\2.   é‡‡ç”¨key value ç¼“å­˜è¯¦æƒ…é¡µä¸»ä½“htmlã€‚")]),_._v(" "),v("p",[_._v("æ–¹æ¡ˆæ¶æ„ï¼š")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/365147/1586936071255-41190fe1-dc72-4d3d-b8f0-815a1434694b.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_13%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),_._v(" "),v("p",[v("strong",[_._v("é—®é¢˜ï¼š")])]),_._v(" "),v("p",[_._v("â€‹    å½“è¾¾åˆ°500QPS çš„æ—¶å€™å¾ˆéš¾ç»§ç»­å‹æµ‹ä¸Šå»ã€‚")]),_._v(" "),v("p",[v("strong",[_._v("åˆ†æåŸå› ")]),_._v("ï¼šä¸€ä¸ªè¯¦æƒ…é¡µhtml ä¸»ä½“è¾¾å¹³å‡150 kb é‚£ä¹ˆåœ¨500QPS å·²æ¥è¿‘åƒMå±€åŸŸç½‘å®½å¸¦æé™ã€‚å¿…é¡»å‡å°‘å†…ç½‘é€šä¿¡ã€‚")]),_._v(" "),v("p",[v("strong",[_._v("åŸºäº****Nginx")]),_._v(" "),v("strong",[_._v("é™æ€ç¼“å­˜çš„è§£å†³æ–¹æ¡ˆï¼š")])]),_._v(" "),v("p",[v("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/365147/1586936078727-9a201301-0fcf-43a7-94d6-5c70cb3861b5.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_16%2Ctext_6bKB54-t5a2m6Zmi5Ye65ZOB%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10",alt:"img"}})]),_._v(" "),v("p",[_._v("2.Nginx é™æ€ç¼“å­˜åŸºæœ¬é…ç½®")]),_._v(" "),v("p",[_._v("ä¸€ã€åœ¨httpå…ƒç´ ä¸‹æ·»åŠ ç¼“å­˜åŒºå£°æ˜ã€‚")]),_._v(" "),v("p",[_._v("#proxy_cache_path ç¼“å­˜è·¯å¾„")]),_._v(" "),v("p",[_._v("#levels ç¼“å­˜å±‚çº§åŠç›®å½•ä½æ•°")]),_._v(" "),v("p",[_._v("#keys_zone ç¼“å­˜åŒºå†…å­˜å¤§å°")]),_._v(" "),v("p",[_._v("#inactive æœ‰æ•ˆæœŸ")]),_._v(" "),v("p",[_._v("#max_size ç¡¬ç›˜å¤§å°")]),_._v(" "),v("p",[_._v("proxy_cache_path /data/nginx/cache_luban levels=1:2 keys_zone=cache_luban:500m inactive=20d max_size=1g;")]),_._v(" "),v("p",[_._v("äºŒã€ä¸ºæŒ‡å®šlocation è®¾å®šç¼“å­˜ç­–ç•¥ã€‚")]),_._v(" "),v("p",[_._v("# æŒ‡å®šç¼“å­˜åŒº")]),_._v(" "),v("p",[_._v("proxy_cache cache_luban;")]),_._v(" "),v("p",[_._v("#ä»¥å…¨è·¯å¾„md5å€¼åšåšä¸ºKey")]),_._v(" "),v("p",[_._v("proxy_cache_key $host$uri$is_args$args;")]),_._v(" "),v("p",[_._v("#å¯¹ä¸åŒçš„HTTPçŠ¶æ€ç è®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´")]),_._v(" "),v("p",[_._v("proxy_cache_valid 200 304 12h;")]),_._v(" "),v("p",[v("strong",[_._v("æ¼”ç¤ºç¼“å­˜ç”Ÿæ•ˆè¿‡ç¨‹")])]),_._v(" "),v("p",[_._v("l é…ç½®å£°æ˜ç¼“å­˜è·¯å¾„")]),_._v(" "),v("p",[_._v("l ä¸ºlocation é…ç½®ç¼“å­˜ç­–ç•¥")]),_._v(" "),v("p",[_._v("l é‡å¯nginxï¼ˆä¿®æ”¹äº†ï¼‰")]),_._v(" "),v("p",[_._v("l æŸ¥çœ‹ç¼“å­˜ç›®å½•ç”Ÿæˆ")]),_._v(" "),v("p",[_._v("ç¼“å­˜å‚æ•°è¯¦ç»†è¯´æ˜")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("çˆ¶å…ƒç´ ")]),_._v(" "),v("th",[_._v("åç§°")]),_._v(" "),v("th",[_._v("æè¿°")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("http")]),_._v(" "),v("td",[_._v("proxy_cache_path")]),_._v(" "),v("td",[_._v("æŒ‡å®šç¼“å­˜åŒºçš„æ ¹è·¯å¾„")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("levels")]),_._v(" "),v("td",[_._v("ç¼“å­˜ç›®å½•å±‚çº§æœ€é«˜ä¸‰å±‚ï¼Œæ¯å±‚1~2ä¸ªå­—ç¬¦è¡¨ç¤ºã€‚å¦‚1:1:2   è¡¨ç¤ºä¸‰å±‚ã€‚")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("keys_zone")]),_._v(" "),v("td",[_._v("ç¼“å­˜å—åç§° åŠå†…å­˜å—å¤§å°ã€‚å¦‚ cache_item:500m ã€‚è¡¨ç¤ºå£°æ˜ä¸€ä¸ªåä¸ºcache_item å¤§å°ä¸º500mã€‚è¶…å‡ºå¤§å°åæœ€æ—©çš„æ•°æ®å°†ä¼šè¢«æ¸…é™¤ã€‚")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("inactive")]),_._v(" "),v("td",[_._v("æœ€é•¿é—²ç½®æ—¶é—´ å¦‚:10d å¦‚æœä¸€ä¸ªæ•°æ®è¢«é—²ç½®10å¤©å°†ä¼šè¢«æ¸…é™¤")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("max_size")]),_._v(" "),v("td",[_._v("ç¼“å­˜åŒºç¡¬ç›˜æœ€å¤§å€¼ã€‚è¶…å‡ºé—²ç½®æ•°æ®å°†ä¼šè¢«æ¸…é™¤")])]),_._v(" "),v("tr",[v("td",[_._v("location")]),_._v(" "),v("td",[_._v("proxy_cache")]),_._v(" "),v("td",[_._v("æŒ‡å®šç¼“å­˜åŒºï¼Œå¯¹åº”keys_zone ä¸­è®¾ç½®çš„å€¼")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("proxy_cache_key")]),_._v(" "),v("td",[_._v("é€šè¿‡å‚æ•°æ‹¼è£…ç¼“å­˜key å¦‚ï¼š$host$uri$is_args$args   åˆ™ä¼šä»¥å…¨è·¯å¾„md5å€¼åšåšä¸ºKey")])]),_._v(" "),v("tr",[v("td"),_._v(" "),v("td",[_._v("proxy_cache_valid")]),_._v(" "),v("td",[_._v("ä¸ºä¸åŒçš„çŠ¶æ€ç è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸ")])])])]),_._v(" "),v("p",[_._v("3.ç¼“å­˜çš„æ¸…é™¤ï¼š")]),_._v(" "),v("p",[_._v("â€‹    è¯¥åŠŸèƒ½å¯ä»¥é‡‡ç”¨ç¬¬ä¸‰æ–¹æ¨¡å— ngx_cache_purge å®ç°ã€‚")]),_._v(" "),v("p",[v("strong",[_._v("ä¸º****nginx")]),_._v(" "),v("strong",[_._v("æ·»åŠ ")]),_._v(" "),v("strong",[_._v("ngx_cache_purge")]),_._v(" "),v("strong",[_._v("æ¨¡å—")])]),_._v(" "),v("p",[_._v("#ä¸‹è½½ngx_cache_purge æ¨¡å—åŒ… ,è¿™é‡Œnginx ç‰ˆæœ¬ä¸º1.6.2 purge å¯¹åº”2.0ç‰ˆ")]),_._v(" "),v("p",[_._v("wget http://labs.frickle.com/files/ngx_cache_purge-2.3.tar.gz")]),_._v(" "),v("p",[_._v("#æŸ¥çœ‹å·²å®‰è£…æ¨¡å—")]),_._v(" "),v("p",[_._v("./sbin/nginx -V")]),_._v(" "),v("p",[_._v("#è¿›å…¥nginxå®‰è£…åŒ…ç›®å½• é‡æ–°å®‰è£… --add-moduleä¸ºæ¨¡å—è§£å‹çš„å…¨è·¯å¾„")]),_._v(" "),v("p",[_._v("./configure --prefix=/root/svr/nginx --with-http_stub_status_module --with-http_ssl_module  --add-module=/root/svr/packages/ngx_cache_purge-2.3")]),_._v(" "),v("p",[_._v("#é‡æ–°ç¼–è¯‘")]),_._v(" "),v("p",[_._v("make")]),_._v(" "),v("p",[_._v("#æ‹·è´ å®‰è£…ç›®å½•/objs/nginx æ–‡ä»¶ç”¨äºæ›¿æ¢åŸnginx æ–‡ä»¶")]),_._v(" "),v("p",[_._v("#æ£€æµ‹æŸ¥çœ‹å®‰è£…æ˜¯å¦æˆåŠŸ")]),_._v(" "),v("p",[_._v("nginx -t")]),_._v(" "),v("p",[v("strong",[_._v("æ¸…é™¤é…ç½®ï¼š")])]),_._v(" "),v("p",[_._v("location ~ /clear(/.*) {")]),_._v(" "),v("p",[_._v("#å…è®¸è®¿é—®çš„IP")]),_._v(" "),v("p",[_._v("allow      127.0.0.1;")]),_._v(" "),v("p",[_._v("allow      192.168.0.193;")]),_._v(" "),v("p",[_._v("#ç¦æ­¢è®¿é—®çš„IP")]),_._v(" "),v("p",[_._v("deny      all;")]),_._v(" "),v("p",[_._v("#é…ç½®æ¸…é™¤æŒ‡å®šç¼“å­˜åŒºå’Œè·¯å¾„(ä¸proxy_cache_keyä¸€è‡³)")]),_._v(" "),v("p",[_._v("proxy_cache_purge  cache_luban $host$1$is_args$args;")]),_._v(" "),v("p",[_._v("}")]),_._v(" "),v("p",[_._v("é…ç½®å¥½ä»¥å ç›´æ¥è®¿é—® ï¼š")]),_._v(" "),v("p",[_._v("# è®¿é—®ç”Ÿæˆç¼“å­˜æ–‡ä»¶")]),_._v(" "),v("p",[_._v("http://www.luban.com/?a=1")]),_._v(" "),v("p",[_._v("# æ¸…é™¤ç”Ÿæˆçš„ç¼“å­˜,å¦‚æœæŒ‡å®šç¼“å­˜ä¸å­˜åœ¨ åˆ™ä¼šæŠ¥404 é”™è¯¯ã€‚")]),_._v(" "),v("p",[_._v("http://www.luban.com/clear/?a=1")]),_._v(" "),v("p",[_._v("ä¸‰ã€Nginx æ€§èƒ½å‚æ•°è°ƒä¼˜")]),_._v(" "),v("p",[v("strong",[_._v("worker_processes number;")])]),_._v(" "),v("p",[_._v("æ¯ä¸ªworkerè¿›ç¨‹éƒ½æ˜¯å•çº¿ç¨‹çš„è¿›ç¨‹ï¼Œå®ƒä»¬ä¼šè°ƒç”¨å„ä¸ªæ¨¡å—ä»¥å®ç°å¤šç§å¤šæ ·çš„åŠŸèƒ½ã€‚å¦‚æœè¿™äº›æ¨¡å—ç¡®è®¤ä¸ä¼šå‡ºç°é˜»å¡å¼çš„è°ƒç”¨ï¼Œé‚£ä¹ˆï¼Œæœ‰å¤šå°‘CPUå†…æ ¸å°±åº”è¯¥é…ç½®å¤šå°‘ä¸ªè¿›ç¨‹ï¼›åä¹‹ï¼Œå¦‚æœæœ‰å¯èƒ½å‡ºç°é˜»å¡å¼è°ƒç”¨ï¼Œé‚£ä¹ˆéœ€è¦é…ç½®ç¨å¤šä¸€äº›çš„workerè¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸šåŠ¡æ–¹é¢ä¼šè‡´ä½¿ç”¨æˆ·è¯·æ±‚å¤§é‡è¯»å–æœ¬åœ°ç£ç›˜ä¸Šçš„é™æ€èµ„æºæ–‡ä»¶ï¼Œè€Œä¸”æœåŠ¡å™¨ä¸Šçš„å†…å­˜è¾ƒå°ï¼Œä»¥è‡³äºå¤§éƒ¨åˆ†çš„è¯·æ±‚è®¿é—®é™æ€èµ„æºæ–‡ä»¶æ—¶éƒ½å¿…é¡»è¯»å–ç£ç›˜ï¼ˆç£å¤´çš„å¯»å€æ˜¯ç¼“æ…¢çš„ï¼‰ï¼Œè€Œä¸æ˜¯å†…å­˜ä¸­çš„ç£ç›˜ç¼“å­˜ï¼Œé‚£ä¹ˆç£ç›˜I/Oè°ƒç”¨å¯èƒ½ä¼šé˜»å¡ä½workerè¿›ç¨‹å°‘é‡æ—¶é—´ï¼Œè¿›è€Œå¯¼è‡´æœåŠ¡æ•´ä½“æ€§èƒ½ä¸‹é™ã€‚")]),_._v(" "),v("p",[v("strong",[_._v("æ¯ä¸ª****worker")]),_._v(" "),v("strong",[_._v("è¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°")])]),_._v(" "),v("p",[v("strong",[_._v("è¯­æ³•")]),_._v("ï¼šworker_connections number;")]),_._v(" "),v("p",[v("strong",[_._v("é»˜è®¤")]),_._v("ï¼šworker_connections 1024")]),_._v(" "),v("p",[v("strong",[_._v("worker_cpu_affinity cpumask[cpumaskâ€¦â€¦]")])]),_._v(" "),v("p",[v("strong",[_._v("ç»‘å®š"),v("strong",[v("strong",[_._v("Nginx worker")])]),_._v("è¿›ç¨‹åˆ°æŒ‡å®šçš„"),v("strong",[v("strong",[_._v("CPU")])]),_._v("å†…æ ¸")])]),_._v(" "),v("p",[_._v("ä¸ºä»€ä¹ˆè¦ç»‘å®šworkerè¿›ç¨‹åˆ°æŒ‡å®šçš„CPUå†…æ ¸å‘¢ï¼Ÿå‡å®šæ¯ä¸€ä¸ªworkerè¿›ç¨‹éƒ½æ˜¯éå¸¸ç¹å¿™çš„ï¼Œå¦‚æœå¤šä¸ªworkerè¿›ç¨‹éƒ½åœ¨æŠ¢åŒä¸€ä¸ªCPUï¼Œé‚£ä¹ˆè¿™å°±ä¼šå‡ºç°åŒæ­¥é—®é¢˜ã€‚åä¹‹ï¼Œå¦‚æœæ¯ä¸€ä¸ªworkerè¿›ç¨‹éƒ½ç‹¬äº«ä¸€ä¸ªCPUï¼Œå°±åœ¨å†…æ ¸çš„è°ƒåº¦ç­–ç•¥ä¸Šå®ç°äº†å®Œå…¨çš„å¹¶å‘ã€‚")]),_._v(" "),v("p",[_._v("ä¾‹å¦‚ï¼Œå¦‚æœæœ‰4é¢—CPUå†…æ ¸ï¼Œå°±å¯ä»¥è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š")]),_._v(" "),v("p",[_._v("worker_processes 4;")]),_._v(" "),v("p",[_._v("worker_cpu_affinity 1000 0100 0010 0001;")]),_._v(" "),v("p",[_._v("æ³¨æ„ worker_cpu_affinityé…ç½®ä»…å¯¹Linuxæ“ä½œç³»ç»Ÿæœ‰æ•ˆã€‚")]),_._v(" "),v("p",[v("strong",[_._v("Nginx worker")]),_._v(" "),v("strong",[_._v("è¿›ç¨‹ä¼˜å…ˆçº§è®¾ç½®")])]),_._v(" "),v("p",[v("strong",[_._v("è¯­æ³•")]),_._v("ï¼šworker_priority nice;")]),_._v(" "),v("p",[v("strong",[_._v("é»˜è®¤")]),_._v("ï¼šworker_priority 0;")]),_._v(" "),v("p",[_._v("ä¼˜å…ˆçº§ç”±é™æ€ä¼˜å…ˆçº§å’Œå†…æ ¸æ ¹æ®è¿›ç¨‹æ‰§è¡Œæƒ…å†µæ‰€åšçš„åŠ¨æ€è°ƒæ•´ï¼ˆç›®å‰åªæœ‰Â±5çš„è°ƒæ•´ï¼‰å…±åŒå†³å®šã€‚niceå€¼æ˜¯è¿›ç¨‹çš„é™æ€ä¼˜å…ˆçº§ï¼Œå®ƒçš„å–å€¼èŒƒå›´æ˜¯â€“20ï½+19ï¼Œâ€“20æ˜¯æœ€é«˜ä¼˜å…ˆçº§ï¼Œ+19æ˜¯æœ€ä½ä¼˜å…ˆçº§ã€‚å› æ­¤ï¼Œå¦‚æœç”¨æˆ·å¸Œæœ›Nginxå æœ‰æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œé‚£ä¹ˆå¯ä»¥æŠŠniceå€¼é…ç½®å¾—æ›´å°ä¸€äº›ï¼Œä½†ä¸å»ºè®®æ¯”å†…æ ¸è¿›ç¨‹çš„niceå€¼ï¼ˆé€šå¸¸ä¸ºâ€“5ï¼‰è¿˜è¦å°")]),_._v(" "),v("p",[v("strong",[_._v("Nginx worker****è¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§å¥æŸ„æè¿°ç¬¦ä¸ªæ•°")])]),_._v(" "),v("p",[v("strong",[_._v("è¯­æ³•")]),_._v("ï¼š worker_rlimit_nofile limit;")]),_._v(" "),v("p",[_._v("**é»˜è®¤ï¼š**ç©º")]),_._v(" "),v("p",[_._v("æ›´æ”¹workerè¿›ç¨‹çš„æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶ã€‚å¦‚æœæ²¡è®¾ç½®çš„è¯ï¼Œè¿™ä¸ªå€¼ä¸ºæ“ä½œç³»ç»Ÿçš„é™åˆ¶ã€‚è®¾ç½®åä½ çš„æ“ä½œç³»ç»Ÿå’ŒNginxå¯ä»¥å¤„ç†æ¯”â€œulimit -aâ€æ›´å¤šçš„æ–‡ä»¶ï¼Œæ‰€ä»¥æŠŠè¿™ä¸ªå€¼è®¾é«˜ï¼Œè¿™æ ·nginxå°±ä¸ä¼šæœ‰â€œtoo many open filesâ€é—®é¢˜äº†ã€‚")]),_._v(" "),v("p",[v("strong",[_._v("æ˜¯å¦æ‰“å¼€"),v("strong",[v("strong",[_._v("accept")])]),_._v("é”")])]),_._v(" "),v("p",[v("strong",[_._v("è¯­æ³•")]),_._v("ï¼šaccept_mutex[on|off]")]),_._v(" "),v("p",[v("strong",[_._v("é»˜è®¤")]),_._v("ï¼šaccept_mutext on;")]),_._v(" "),v("p",[_._v("accept_mutexæ˜¯Nginxçš„è´Ÿè½½å‡è¡¡é”ï¼Œå½“æŸä¸€ä¸ªworkerè¿›ç¨‹å»ºç«‹çš„è¿æ¥æ•°é‡è¾¾åˆ°worker_connectionsé…ç½®çš„æœ€å¤§è¿æ¥æ•°çš„7/8æ—¶ï¼Œä¼šå¤§å¤§åœ°å‡å°è¯¥workerè¿›ç¨‹è¯•å›¾å»ºç«‹æ–°TCPè¿æ¥çš„æœºä¼šï¼Œaccepté”é»˜è®¤æ˜¯æ‰“å¼€çš„ï¼Œå¦‚æœå…³é—­å®ƒï¼Œé‚£ä¹ˆå»ºç«‹TCPè¿æ¥çš„è€—æ—¶ä¼šæ›´çŸ­ï¼Œä½†workerè¿›ç¨‹ä¹‹é—´çš„è´Ÿè½½ä¼šéå¸¸ä¸å‡è¡¡ï¼Œå› æ­¤ä¸å»ºè®®å…³é—­å®ƒã€‚")]),_._v(" "),v("p",[v("strong",[_._v("ä½¿ç”¨"),v("strong",[v("strong",[_._v("accept")])]),_._v("é”ååˆ°çœŸæ­£å»ºç«‹è¿æ¥ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´")])]),_._v(" "),v("p",[_._v("è¯­æ³•ï¼šaccept_mutex_delay Nms;")]),_._v(" "),v("p",[_._v("é»˜è®¤ï¼šaccept_mutex_delay 500ms;")]),_._v(" "),v("p",[_._v("åœ¨ä½¿ç”¨accepté”åï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªworkerè¿›ç¨‹èƒ½å¤Ÿå–åˆ°accepté”ã€‚è¿™ä¸ªaccepté”ä¸æ˜¯å µå¡é”ï¼Œå¦‚æœå–ä¸åˆ°ä¼šç«‹åˆ»è¿”å›ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªworkerè¿›ç¨‹è¯•å›¾å–é”è€Œæ²¡æœ‰å–åˆ°ï¼Œä»–è‡³å°‘è¦ç­‰å¾…accept_mutex_delayå®šä¹‰çš„æ—¶é—´æ‰èƒ½å†æ¬¡è¯•å›¾å–é”ã€‚")])])}),[],!1,null,null,null);v.default=r.exports}}]);